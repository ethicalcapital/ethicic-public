/*!
 * Garden Button System - Enhanced Clean Implementation
 * Consolidates all button-related fixes into a coherent system
 */

@layer components {
  /* ===== BUTTON FOUNDATION ===== */

  /* Base button styles - applies to all Garden buttons */
  .garden-action,
  .garden-button,
  .garden-btn,
  button[class*="garden"],
  a[class*="garden-button"] {
    /* Layout & Positioning */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
    position: relative;
    z-index: 1;

    /* Typography */
    font-family: var(--font-sans);
    font-weight: var(--font-semibold);
    font-size: var(--font-base);
    line-height: 1.4;
    text-align: center;
    text-decoration: none;
    white-space: nowrap;

    /* Spacing & Sizing */
    min-height: 44px; /* WCAG touch target minimum */
    min-width: 44px;
    padding: var(--space-3) var(--space-6);
    border-width: 2px;
    border-style: solid;
    border-radius: var(--radius-md);

    /* Interaction */
    cursor: pointer;
    transition:
      background-color var(--duration-fast) var(--ease-out),
      color var(--duration-fast) var(--ease-out),
      border-color var(--duration-fast) var(--ease-out),
      transform var(--duration-fast) var(--ease-out),
      box-shadow var(--duration-fast) var(--ease-out);

    /* Prevent text overflow */
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ===== BUTTON VARIANTS ===== */

  /* Primary buttons - Purple background, white text */
  .garden-action.primary,
  .garden-action:not(.secondary, .surface, .outline, .ghost),
  .garden-button-primary {
    background: var(--color-primary);
    color: var(--color-on-primary);
    border-color: var(--color-primary);
    text-shadow: 0 1px 2px var(--color-shadow-30);
  }

  .garden-action.primary:hover,
  .garden-button-primary:hover {
    background: var(--color-primary-hover);
    border-color: var(--color-primary-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
  }

  /* Secondary buttons - Transparent background, purple text */
  .garden-action.secondary,
  .garden-button-secondary {
    background: transparent;
    color: var(--color-primary);
    border-color: var(--color-border);
  }

  .garden-action.secondary:hover,
  .garden-button-secondary:hover {
    background: var(--color-surface-secondary);
    color: var(--color-primary);
    border-color: var(--color-primary);
  }

  /* Surface buttons - Light background, dark text */
  .garden-action.surface,
  .garden-button-surface {
    background: var(--color-surface);
    color: var(--color-text-primary);
    border-color: var(--color-border);
  }

  .garden-action.surface:hover,
  .garden-button-surface:hover {
    background: var(--color-surface-secondary);
    color: var(--color-primary);
    border-color: var(--color-primary);
  }

  /* ===== BUTTON STATES ===== */

  /* Focus state for accessibility */
  .garden-action:focus-visible,
  .garden-button:focus-visible {
    outline: 2px solid var(--color-focus, var(--color-secondary));
    outline-offset: 2px;
  }

  /* Disabled state */
  .garden-action:disabled,
  .garden-action.disabled,
  .garden-button:disabled,
  .garden-button.disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: var(--color-surface-secondary);
    color: var(--color-text-secondary);
    border-color: var(--color-border);
    transform: none;
    box-shadow: none;
  }

  /* Loading state */
  .garden-action.loading,
  .garden-button.loading {
    color: transparent;
    pointer-events: none;
  }

  .garden-action.loading::after,
  .garden-button.loading::after {
    content: "‚ü≥";
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) rotate(0deg);
    color: var(--color-on-primary);
    animation: button-loading-spin 1s linear infinite;
  }

  @keyframes button-loading-spin {
    to { transform: translate(-50%, -50%) rotate(360deg); }
  }

  /* ===== SPECIFIC USE CASES ===== */

  /* CTA Panel buttons */
  .cta-panel .garden-action,
  .cta-actions .garden-action {
    min-height: 48px;
    padding: var(--space-3) var(--space-6);
    font-weight: var(--font-bold);
    white-space: nowrap;
    flex-shrink: 0;
  }

  /* Header buttons */
  .garden-header .garden-action {
    min-height: 40px;
    padding: var(--space-2) var(--space-4);
    font-size: var(--font-sm);
    border-width: 1px;
  }

  /* Homepage CTA buttons - specific targeting for high specificity needs */
  .home-page .cta-panel .garden-action {
    min-height: 48px;
    padding: var(--space-3) var(--space-6);
    font-weight: var(--font-bold);
  }

  /* Process page step numbers - special button-like elements */
  .step-number {
    background: var(--color-primary);
    color: var(--color-on-primary);
    width: 48px;
    height: 48px;
    min-width: 48px;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: var(--font-bold);
    flex-shrink: 0;
  }

  /* ===== BUTTON GROUPS ===== */

  /* Button group spacing */
  .garden-button-group {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
  }

  .garden-button-group .garden-action,
  .garden-button-group .garden-button {
    margin: 0; /* Reset any inherited margins */
  }

  /* ===== RESPONSIVE DESIGN ===== */

  /* Mobile optimizations */
  @media (width <= 768px) {
    .garden-action,
    .garden-button {
      padding: var(--space-4) var(--space-5);
      font-size: var(--font-sm);
      min-height: 48px; /* Larger touch targets on mobile */
    }

    /* Allow text wrapping for long CTAs on mobile if needed */
    .garden-action.allow-wrap,
    .garden-button.allow-wrap {
      white-space: normal;
      text-align: center;
      line-height: 1.3;
      padding: var(--space-4) var(--space-6);
    }

    /* Button groups stack on mobile */
    .garden-button-group {
      flex-direction: column;
      align-items: stretch;
    }

    .garden-button-group .garden-action,
    .garden-button-group .garden-button {
      width: 100%;
    }
  }

  /* Small mobile adjustments */
  @media (width <= 480px) {
    .garden-action,
    .garden-button {
      font-size: var(--font-sm);
      padding: var(--space-3) var(--space-5);
    }
  }

  /* ===== THEME SUPPORT ===== */

  /* Dark theme adjustments for secondary buttons */
  [data-theme="dark"] .garden-action.secondary,
  [data-theme="dark"] .garden-button-secondary {
    color: #9d7bda; /* Lighter purple for better contrast on dark background */
    border-color: #4a4a4a; /* Lighter border for visibility */
  }

  [data-theme="dark"] .garden-action.secondary:hover,
  [data-theme="dark"] .garden-button-secondary:hover {
    background: rgb(157 123 218 / 10%); /* Light purple background on hover */
    color: #b399e0; /* Even lighter purple on hover */
    border-color: #9d7bda;
  }

  /* ===== ACCESSIBILITY ENHANCEMENTS ===== */

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .garden-action,
    .garden-button {
      border-width: 3px;
      font-weight: var(--font-bold);
    }

    .garden-action.primary,
    .garden-button.primary {
      background: Canvas;
      color: CanvasText;
      border-color: CanvasText;
    }

    .garden-action.secondary,
    .garden-button.secondary {
      background: Canvas;
      color: CanvasText;
      border-color: CanvasText;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .garden-action,
    .garden-button {
      transition: none;
    }

    .garden-action.loading::after,
    .garden-button.loading::after {
      animation: none;
    }
  }
}

@layer utilities {
  /* ===== EMERGENCY OVERRIDES ===== */
  /* High-specificity fixes when component layer isn't sufficient */

  /* Force button alignment in problematic containers */
  .force-button-center .garden-action,
  .force-button-center .garden-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    vertical-align: middle;
  }

  /* Force proper button sizing */
  .force-button-size .garden-action,
  .force-button-size .garden-button {
    min-height: 48px;
    min-width: 44px;
    padding: var(--space-3) var(--space-6);
  }

  /* Force button contrast for accessibility */
  .force-button-contrast .garden-action.primary {
    background: var(--color-primary);
    color: var(--color-on-primary);
    border-color: var(--color-primary);
  }
}
