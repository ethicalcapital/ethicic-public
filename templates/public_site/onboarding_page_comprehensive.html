{% extends "public_site/base.html" %}
{% load wagtailcore_tags %}
{% load static %}

{% block title %}Onboarding - Ethical Capital{% endblock %}

{% block body_class %}onboarding-page comprehensive{% endblock %}

{% block content %}
<div class="garden-container">
    <!-- Hero Section -->
    <section class="garden-panel hero-panel" role="banner" aria-labelledby="hero-heading">
        <div class="panel-header">ETHICAL CAPITAL ONBOARDING</div>
        <div class="panel-content">
            <h1 id="hero-heading" class="hero-title">Welcome to Ethical Capital</h1>
            <div class="hero-subtitle">
                <p>I'm delighted to welcome you to Ethical Capital. Our client relationships are lifelong partnerships, so this form is designed to quicken the "getting to know you" process so we can serve you with loyalty, prudence, and care over the long term.</p>
                <p><strong>But to be clear, we want to know you.</strong></p>
                <p>That means: be human. You are encouraged to make jokes, share fears, and say "I don't know" without a moment's hesitation.</p>
                <p>Thank you in advance for sharing a bit of yourself with us. And welcome!</p>
            </div>
        </div>
    </section>

    <main class="main-content">
        <!-- Form Container -->
        <div class="form-container" x-data="onboardingForm()">
            <!-- Progress Indicator Panel -->
            <section class="garden-panel progress-panel">
                <div class="panel-header">PROGRESS</div>
                <div class="panel-content">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" :style="`width: ${progress}%`"></div>
                        </div>
                        <div class="progress-text" x-text="progressText"></div>

                        <!-- Step Dots -->
                        <div class="step-indicators">
                            <template x-for="displayStep in actualTotalSteps" :key="displayStep">
                                <div class="step-dot"
                                     :class="{
                                        'completed': displayStep < actualStepNumber,
                                        'current': displayStep === actualStepNumber,
                                        'future': displayStep > actualStepNumber
                                     }"
                                     @click="goToDisplayStep(displayStep)"
                                     x-text="displayStep">
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Comprehensive Onboarding Form -->
            <form id="onboardingForm" method="post" action="/onboarding/submit/"
                  @submit.prevent="submitting = true; $el.submit()">
                {% csrf_token %}

                <!-- Section 1: About You -->
                <section class="garden-panel form-section" :class="{ 'active': currentStep === 1 }" data-step="1" x-show="currentStep === 1">
                    <div class="panel-header">ABOUT YOU</div>
                    <div class="panel-content">
                        <div class="section-description">We're so excited to get to know you! This section will gather the basic information about you that we need in order to open your account.</div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="email">What's the best email to reach you at?</label>
                            <input type="email" id="email" name="email" class="garden-input" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="first_name">What's your first name?</label>
                            <input type="text" id="first_name" name="first_name" class="garden-input" autocomplete="given-name" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" for="middle_names">What are your middle names? (optional)</label>
                            <input type="text" id="middle_names" name="middle_names" class="garden-input" autocomplete="additional-name" placeholder="Enter all middle names separated by spaces">
                            <div class="form-help">Enter all middle names separated by spaces</div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="last_name">What's your last name?</label>
                            <input type="text" id="last_name" name="last_name" class="garden-input" autocomplete="family-name" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">Would you prefer we call you by any other name?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="preferred_name_choice" value="nope" class="radio-input" @change="$refs.preferredNameField.style.display = 'none'" checked>
                                    <span class="radio-label">Nope</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="preferred_name_choice" value="other" class="radio-input" @change="$refs.preferredNameField.style.display = 'block'">
                                    <span class="radio-label">Other</span>
                                </label>
                            </div>
                            <div x-ref="preferredNameField" style="display: none;" class="garden-form-group mt-3">
                                <input type="text" name="preferred_name" class="garden-input" placeholder="Preferred name">
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">What are your pronouns?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="pronouns" value="he/him" class="radio-input" @change="$refs.pronounsOtherField.style.display = 'none'">
                                    <span class="radio-label">he/him</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="pronouns" value="she/her" class="radio-input" @change="$refs.pronounsOtherField.style.display = 'none'">
                                    <span class="radio-label">she/her</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="pronouns" value="they/them" class="radio-input" @change="$refs.pronounsOtherField.style.display = 'none'">
                                    <span class="radio-label">they/them</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="pronouns" value="other" class="radio-input" @change="$refs.pronounsOtherField.style.display = 'block'">
                                    <span class="radio-label">Other</span>
                                </label>
                            </div>
                            <div x-ref="pronounsOtherField" style="display: none;" class="garden-form-group mt-3">
                                <input type="text" name="pronouns_other" class="garden-input" placeholder="Your pronouns">
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="street_address">Street address</label>
                            <input type="text" id="street_address" name="street_address" class="garden-input" autocomplete="address-line1" required>
                            <div class="form-help">Enter your street address (PO Boxes are not permitted)</div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" for="street_address_2">Apartment, suite, unit, etc. (optional)</label>
                            <input type="text" id="street_address_2" name="street_address_2" class="garden-input" autocomplete="address-line2">
                        </div>

                        <div class="garden-form-group-row">
                            <div class="garden-form-group">
                                <label class="form-label required" for="city">City</label>
                                <input type="text" id="city" name="city" class="garden-input" autocomplete="address-level2" required>
                            </div>
                            <div class="garden-form-group">
                                <label class="form-label required" for="state">State/Province</label>
                                <input type="text" id="state" name="state" class="garden-input" autocomplete="address-level1" required>
                            </div>
                            <div class="garden-form-group">
                                <label class="form-label required" for="zip_code">ZIP/Postal code</label>
                                <input type="text" id="zip_code" name="zip_code" class="garden-input" autocomplete="postal-code" required>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="country">Country</label>
                            <input type="text" id="country" name="country" class="garden-input" autocomplete="country-name" value="United States" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="phone">What's your phone number?</label>
                            <input type="tel" id="phone" name="phone" class="garden-input" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="birthday">What's your birthday?</label>
                            <input type="date" id="birthday" name="birthday" class="garden-input" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">How would you describe your employment status?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="employment_status" value="full_time" class="radio-input" @change="$refs.employmentFields.style.display = 'block'">
                                    <span class="radio-label">Full-time employed</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="employment_status" value="part_time" class="radio-input" @change="$refs.employmentFields.style.display = 'block'">
                                    <span class="radio-label">Part-time employed</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="employment_status" value="self_employed" class="radio-input" @change="$refs.employmentFields.style.display = 'block'">
                                    <span class="radio-label">Self-employed</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="employment_status" value="retired" class="radio-input" @change="$refs.employmentFields.style.display = 'none'">
                                    <span class="radio-label">Retired</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="employment_status" value="unemployed" class="radio-input" @change="$refs.employmentFields.style.display = 'none'">
                                    <span class="radio-label">Unemployed</span>
                                </label>
                            </div>
                        </div>

                        <div x-ref="employmentFields" style="display: none;">
                            <div class="garden-form-group">
                                <label class="form-label" for="employer_name">What's the name of your employer?</label>
                                <input type="text" id="employer_name" name="employer_name" class="garden-input">
                            </div>
                            <div class="garden-form-group">
                                <label class="form-label" for="job_title">What's your job title?</label>
                                <input type="text" id="job_title" name="job_title" class="garden-input">
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">How would you describe your marital status?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="marital_status" value="single" class="radio-input">
                                    <span class="radio-label">Single</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="marital_status" value="married" class="radio-input">
                                    <span class="radio-label">Married</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="marital_status" value="partnered" class="radio-input">
                                    <span class="radio-label">Partnered</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="marital_status" value="complicated" class="radio-input">
                                    <span class="radio-label">It's complicated</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">Would you like to add anyone else to your household?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="add_co_client" value="yes" class="radio-input" @change="addCoClient = true">
                                    <span class="radio-label">Yes!</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="add_co_client" value="no" class="radio-input" @change="addCoClient = false" checked>
                                    <span class="radio-label">No, thank you.</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-navigation">
                            <div></div>
                            <button type="button" class="garden-action primary" @click="nextStep()">Continue</button>
                        </div>
                    </div>
                </section>

                <!-- Section 2: Your Co-Client (conditional) -->
                <section class="garden-panel form-section" data-step="2"
                         x-show="currentStep === 2 && addCoClient"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 transform translate-y-4"
                         x-transition:enter-end="opacity-100 transform translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 transform translate-y-0"
                         x-transition:leave-end="opacity-0 transform translate-y-4">
                    <div class="panel-header">YOUR CO-CLIENT</div>
                    <div class="panel-content">
                        <div class="section-description">The more, the merrier! We just need a bit more information so we can come up with a better nickname than "co-client."</div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}" for="co_client_first_name">What's your co-client's first name?</label>
                            <input type="text" id="co_client_first_name" name="co_client_first_name" class="garden-input" :required="addCoClient">
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" for="co_client_middle_names">What are your co-client's middle names? (optional)</label>
                            <input type="text" id="co_client_middle_names" name="co_client_middle_names" class="garden-input" placeholder="Enter all middle names separated by spaces">
                            <div class="form-help">Enter all middle names separated by spaces</div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}" for="co_client_last_name">What's your co-client's last name?</label>
                            <input type="text" id="co_client_last_name" name="co_client_last_name" class="garden-input" :required="addCoClient">
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}">Should we call them that, or something other than that?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="co_client_call_them" value="that" class="radio-input" @change="$refs.coClientPreferredNameField.style.display = 'none'" checked>
                                    <span class="radio-label">Call them that!</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_call_them" value="other" class="radio-input" @change="$refs.coClientPreferredNameField.style.display = 'block'">
                                    <span class="radio-label">Other</span>
                                </label>
                            </div>
                            <div x-ref="coClientPreferredNameField" style="display: none;" class="garden-form-group mt-3">
                                <input type="text" name="co_client_preferred_name" class="garden-input" placeholder="Preferred name">
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}" for="co_client_email">What's the best email to reach them at?</label>
                            <input type="email" id="co_client_email" name="co_client_email" class="garden-input" :required="addCoClient">
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}">What are their pronouns?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="co_client_pronouns" value="he/him" class="radio-input" @change="$refs.coClientPronounsOtherField.style.display = 'none'">
                                    <span class="radio-label">he/him</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_pronouns" value="she/her" class="radio-input" @change="$refs.coClientPronounsOtherField.style.display = 'none'">
                                    <span class="radio-label">she/her</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_pronouns" value="they/them" class="radio-input" @change="$refs.coClientPronounsOtherField.style.display = 'none'">
                                    <span class="radio-label">they/them</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_pronouns" value="other" class="radio-input" @change="$refs.coClientPronounsOtherField.style.display = 'block'">
                                    <span class="radio-label">Other</span>
                                </label>
                            </div>
                            <div x-ref="coClientPronounsOtherField" style="display: none;" class="garden-form-group mt-3">
                                <input type="text" name="co_client_pronouns_other" class="garden-input" placeholder="Their pronouns">
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}" for="co_client_phone">What's their phone number?</label>
                            <input type="tel" id="co_client_phone" name="co_client_phone" class="garden-input" :required="addCoClient">
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}" for="co_client_birthday">What's their birthday?</label>
                            <input type="date" id="co_client_birthday" name="co_client_birthday" class="garden-input" :required="addCoClient">
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}">What best describes their employment status?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="co_client_employment_status" value="full_time" class="radio-input" @change="$refs.coClientEmploymentFields.style.display = 'block'">
                                    <span class="radio-label">Full-time employed</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_employment_status" value="part_time" class="radio-input" @change="$refs.coClientEmploymentFields.style.display = 'block'">
                                    <span class="radio-label">Part-time employed</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_employment_status" value="self_employed" class="radio-input" @change="$refs.coClientEmploymentFields.style.display = 'block'">
                                    <span class="radio-label">Self-employed</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_employment_status" value="retired" class="radio-input" @change="$refs.coClientEmploymentFields.style.display = 'none'">
                                    <span class="radio-label">Retired</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_employment_status" value="unemployed" class="radio-input" @change="$refs.coClientEmploymentFields.style.display = 'none'">
                                    <span class="radio-label">Unemployed</span>
                                </label>
                            </div>
                        </div>

                        <div x-ref="coClientEmploymentFields" style="display: none;">
                            <div class="garden-form-group">
                                <label class="form-label" for="co_client_employer_name">What's the name of their employer?</label>
                                <input type="text" id="co_client_employer_name" name="co_client_employer_name" class="garden-input">
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" :class="{'required': addCoClient}">Do you share a mailing address with your co-client?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="co_client_share_address" value="yes" class="radio-input" @change="$refs.coClientAddressField.style.display = 'none'" checked>
                                    <span class="radio-label">Yes</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="co_client_share_address" value="no" class="radio-input" @change="$refs.coClientAddressField.style.display = 'block'">
                                    <span class="radio-label">No</span>
                                </label>
                            </div>
                            <div x-ref="coClientAddressField" style="display: none;" class="garden-form-group mt-3">
                                <label class="form-label" for="co_client_mailing_address">Co-client's mailing address</label>
                                <textarea id="co_client_mailing_address" name="co_client_mailing_address" class="garden-input" rows="3"></textarea>
                            </div>
                        </div>

                        <div class="form-navigation">
                            <button type="button" class="garden-action secondary" @click="prevStep()">Back</button>
                            <button type="button" class="garden-action primary" @click="nextStep()">Continue</button>
                        </div>
                    </div>
                </section>

                <!-- Section 3: Your Contact Preferences -->
                <section class="garden-panel form-section" data-step="3" x-show="currentStep === 3">
                    <div class="panel-header">YOUR CONTACT PREFERENCES</div>
                    <div class="panel-content">
                        <div class="section-description">We're big fans of consent, so let us know how you'd prefer to stay in touch!</div>

                        <div class="garden-form-group">
                            <label class="form-label required">How do you prefer to communicate with us?</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="communication_preference" value="email" class="checkbox-input">
                                    <span class="checkbox-label">Email</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="communication_preference" value="phone" class="checkbox-input">
                                    <span class="checkbox-label">Phone</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="communication_preference" value="virtual_meetings" class="checkbox-input">
                                    <span class="checkbox-label">I'd like to schedule virtual meetings</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="communication_preference" value="client_contact" class="checkbox-input">
                                    <span class="checkbox-label">I'll contact you</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">Would you like to subscribe to our email newsletter?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="newsletter_subscribe" value="yes" class="radio-input">
                                    <span class="radio-label">Yes, please!</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="newsletter_subscribe" value="no" class="radio-input">
                                    <span class="radio-label">No, thank you.</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-navigation">
                            <button type="button" class="garden-action secondary" @click="prevStep()">Back</button>
                            <button type="button" class="garden-action primary" @click="nextStep()">Continue</button>
                        </div>
                    </div>
                </section>

                <!-- Section 4: Your Willingness and Ability to Take Investment Risk -->
                <section class="garden-panel form-section" data-step="4" x-show="currentStep === 4">
                    <div class="panel-header">YOUR WILLINGNESS AND ABILITY TO TAKE INVESTMENT RISK</div>
                    <div class="panel-content">
                        <div class="section-description">We need to understand the way your brain works in order to deliver the best possible results over the long term. So don't think too hard about these questions! Your intuitive responses are by far the best here: they'll help us craft a long-term investment strategy that you can truly consent to.</div>

                        <div class="garden-form-group">
                            <label class="form-label required">It would bother me if my account gained 10% over a 3-6 month period, but it could have gained 25%</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_1" value="strongly_agree" class="radio-input">
                                    <span class="radio-label">Strongly agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_1" value="agree" class="radio-input">
                                    <span class="radio-label">Agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_1" value="neutral" class="radio-input">
                                    <span class="radio-label">Neutral.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_1" value="disagree" class="radio-input">
                                    <span class="radio-label">Disagree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_1" value="strongly_disagree" class="radio-input">
                                    <span class="radio-label">Strongly disagree.</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">Avoiding the worst case scenario matters more to me than maximizing my investment returns.</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_2" value="strongly_agree" class="radio-input">
                                    <span class="radio-label">Strongly agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_2" value="agree" class="radio-input">
                                    <span class="radio-label">Agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_2" value="neutral" class="radio-input">
                                    <span class="radio-label">Neutral.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_2" value="disagree" class="radio-input">
                                    <span class="radio-label">Disagree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_2" value="strongly_disagree" class="radio-input">
                                    <span class="radio-label">Strongly disagree.</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">I try to avoid risk in most areas of my life.</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_3" value="strongly_agree" class="radio-input">
                                    <span class="radio-label">Strongly agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_3" value="agree" class="radio-input">
                                    <span class="radio-label">Agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_3" value="neutral" class="radio-input">
                                    <span class="radio-label">Neutral.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_3" value="disagree" class="radio-input">
                                    <span class="radio-label">Disagree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_3" value="strongly_disagree" class="radio-input">
                                    <span class="radio-label">Strongly disagree.</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">I rarely, if ever, lose sleep because of stress and anxiety.</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_4" value="strongly_agree" class="radio-input">
                                    <span class="radio-label">Strongly agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_4" value="agree" class="radio-input">
                                    <span class="radio-label">Agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_4" value="neutral" class="radio-input">
                                    <span class="radio-label">Neutral.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_4" value="disagree" class="radio-input">
                                    <span class="radio-label">Disagree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_4" value="strongly_disagree" class="radio-input">
                                    <span class="radio-label">Strongly Disagree.</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">I plan to stay invested for a long enough period to recover from a temporary decline in stock prices.</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_5" value="strongly_agree" class="radio-input">
                                    <span class="radio-label">Strongly agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_5" value="agree" class="radio-input">
                                    <span class="radio-label">Agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_5" value="neutral" class="radio-input">
                                    <span class="radio-label">Neutral.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_5" value="disagree" class="radio-input">
                                    <span class="radio-label">Disagree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_5" value="strongly_disagree" class="radio-input">
                                    <span class="radio-label">Strongly disagree.</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">I'd worry less about my finances if my investments fully aligned with my values</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_6" value="strongly_agree" class="radio-input">
                                    <span class="radio-label">Strongly agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_6" value="agree" class="radio-input">
                                    <span class="radio-label">Agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_6" value="neutral" class="radio-input">
                                    <span class="radio-label">Neutral.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_6" value="disagree" class="radio-input">
                                    <span class="radio-label">Disagree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_6" value="strongly_disagree" class="radio-input">
                                    <span class="radio-label">Strongly disagree.</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">I would rather experience financial volatility than compromise my ethical beliefs.</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_7" value="strongly_agree" class="radio-input">
                                    <span class="radio-label">Strongly agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_7" value="agree" class="radio-input">
                                    <span class="radio-label">Agree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_7" value="neutral" class="radio-input">
                                    <span class="radio-label">Neutral.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_7" value="disagree" class="radio-input">
                                    <span class="radio-label">Disagree.</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="risk_question_7" value="strongly_disagree" class="radio-input">
                                    <span class="radio-label">Strongly disagree.</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-navigation">
                            <button type="button" class="garden-action secondary" @click="prevStep()">Back</button>
                            <button type="button" class="garden-action primary" @click="nextStep()">Continue</button>
                        </div>
                    </div>
                </section>

                <!-- Section 5: Your Values and Viewpoint -->
                <section class="garden-panel form-section" data-step="5" x-show="currentStep === 5">
                    <div class="panel-header">YOUR VALUES AND VIEWPOINT</div>
                    <div class="panel-content">
                        <div class="section-description">At Ethical Capital, we maintain a unified ethical framework that applies consistently across all client portfolios. So this section isn't about creating a customized ethical approach for you specifically. Instead, we're gathering your insights to strengthen our collective standards. Because when one client raises a novel ethical concern, all of us benefit from their perspective.</div>
                        <div class="section-description">You'd be surprised how many times clients with no professional background in investing or sustainability have steered us away from danger well before it was obvious. So thank you in advance!</div>

                        <div class="garden-form-group">
                            <label class="form-label">What ethical considerations are critically important to you when thinking about your investments?</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="ethical_considerations" value="animal_welfare" class="checkbox-input">
                                    <span class="checkbox-label">Animal welfare</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="ethical_considerations" value="corporate_governance" class="checkbox-input">
                                    <span class="checkbox-label">Corporate governance</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="ethical_considerations" value="corruption" class="checkbox-input">
                                    <span class="checkbox-label">Corruption</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="ethical_considerations" value="environmental_impact" class="checkbox-input">
                                    <span class="checkbox-label">Environmental impact & sustainability</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="ethical_considerations" value="human_rights" class="checkbox-input">
                                    <span class="checkbox-label">Human rights</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="ethical_considerations" value="labor_practices" class="checkbox-input">
                                    <span class="checkbox-label">Labor practices</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="ethical_considerations" value="social_justice" class="checkbox-input">
                                    <span class="checkbox-label">Social justice</span>
                                </label>
                            </div>
                            <div class="garden-form-group mt-3">
                                <label class="form-label" for="ethical_considerations_other">Other:</label>
                                <textarea id="ethical_considerations_other" name="ethical_considerations_other" class="garden-input" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label">Our investment strategies align with several activist-led divestment movements. Are any of them critically important to you?</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="divestment_movements" value="bds" class="checkbox-input">
                                    <span class="checkbox-label">BDS</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="divestment_movements" value="fossil_fuels" class="checkbox-input">
                                    <span class="checkbox-label">Fossil Fuels</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="divestment_movements" value="modern_slavery" class="checkbox-input">
                                    <span class="checkbox-label">Modern Slavery</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="divestment_movements" value="private_prisons" class="checkbox-input">
                                    <span class="checkbox-label">Private Prisons</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="divestment_movements" value="tobacco" class="checkbox-input">
                                    <span class="checkbox-label">Tobacco</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="divestment_movements" value="weapons" class="checkbox-input">
                                    <span class="checkbox-label">Weapons</span>
                                </label>
                            </div>
                            <div class="garden-form-group mt-3">
                                <label class="form-label" for="divestment_movements_other">Other:</label>
                                <textarea id="divestment_movements_other" name="divestment_movements_other" class="garden-input" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">How important is it for you to understand why each company is included in your portfolio?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="understanding_importance" value="extremely" class="radio-input" @change="$refs.understandingOtherField.style.display = 'none'">
                                    <span class="radio-label">Extremely</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="understanding_importance" value="very" class="radio-input" @change="$refs.understandingOtherField.style.display = 'none'">
                                    <span class="radio-label">Very</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="understanding_importance" value="somewhat" class="radio-input" @change="$refs.understandingOtherField.style.display = 'none'">
                                    <span class="radio-label">Somewhat</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="understanding_importance" value="not_very" class="radio-input" @change="$refs.understandingOtherField.style.display = 'none'">
                                    <span class="radio-label">Not very</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="understanding_importance" value="other" class="radio-input" @change="$refs.understandingOtherField.style.display = 'block'">
                                    <span class="radio-label">Other</span>
                                </label>
                            </div>
                            <div x-ref="understandingOtherField" style="display: none;" class="garden-form-group mt-3">
                                <input type="text" name="understanding_importance_other" class="garden-input" placeholder="Please specify">
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">We evolve our ethical framework whenever we discover new information. How does that make you feel?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="ethical_evolution" value="strongly_support" class="radio-input" @change="$refs.evolutionOtherField.style.display = 'none'">
                                    <span class="radio-label">I strongly support this</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="ethical_evolution" value="support" class="radio-input" @change="$refs.evolutionOtherField.style.display = 'none'">
                                    <span class="radio-label">I support this</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="ethical_evolution" value="neutral" class="radio-input" @change="$refs.evolutionOtherField.style.display = 'none'">
                                    <span class="radio-label">I'm neutral</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="ethical_evolution" value="concerned" class="radio-input" @change="$refs.evolutionOtherField.style.display = 'none'">
                                    <span class="radio-label">I'm concerned</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="ethical_evolution" value="other" class="radio-input" @change="$refs.evolutionOtherField.style.display = 'block'">
                                    <span class="radio-label">Other</span>
                                </label>
                            </div>
                            <div x-ref="evolutionOtherField" style="display: none;" class="garden-form-group mt-3">
                                <input type="text" name="ethical_evolution_other" class="garden-input" placeholder="Please specify">
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" for="ethical_concerns_unrecognized">Are you motivated by ethical concerns that might not be widely recognized?</label>
                            <textarea id="ethical_concerns_unrecognized" name="ethical_concerns_unrecognized" class="garden-input" rows="3"></textarea>
                        </div>

                        <div class="form-navigation">
                            <button type="button" class="garden-action secondary" @click="prevStep()">Back</button>
                            <button type="button" class="garden-action primary" @click="nextStep()">Continue</button>
                        </div>
                    </div>
                </section>

                <!-- Section 6: Your Financial Context -->
                <section class="garden-panel form-section" data-step="6" x-show="currentStep === 6">
                    <div class="panel-header">YOUR FINANCIAL CONTEXT</div>
                    <div class="panel-content">
                        <div class="garden-form-group">
                            <label class="form-label required">How would you describe your level of investment experience?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="investment_experience" value="nonexistent" class="radio-input">
                                    <span class="radio-label">Nonexistent</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="investment_experience" value="limited" class="radio-input">
                                    <span class="radio-label">Limited</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="investment_experience" value="average" class="radio-input">
                                    <span class="radio-label">Average</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="investment_experience" value="advanced" class="radio-input">
                                    <span class="radio-label">Advanced</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="investment_experience" value="professional" class="radio-input">
                                    <span class="radio-label">Professional</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">If you suddenly needed $1,000, would you be able to access it without selling investments or taking on debt?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="emergency_access" value="yes" class="radio-input">
                                    <span class="radio-label">Yes</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="emergency_access" value="no" class="radio-input">
                                    <span class="radio-label">No</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="emergency_access" value="not_sure" class="radio-input">
                                    <span class="radio-label">I'm not sure</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="net_worth">What's your approximate net worth?</label>
                            <input type="text" id="net_worth" name="net_worth" class="garden-input" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="liquid_net_worth">What's your liquid net worth?</label>
                            <input type="text" id="liquid_net_worth" name="liquid_net_worth" class="garden-input" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required" for="investable_net_worth">What's your investable net worth?</label>
                            <input type="text" id="investable_net_worth" name="investable_net_worth" class="garden-input" required>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">How familiar are you with the way we invest?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="investment_familiarity" value="not_very" class="radio-input">
                                    <span class="radio-label">Not very</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="investment_familiarity" value="get_gist" class="radio-input">
                                    <span class="radio-label">I get the gist</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="investment_familiarity" value="understand" class="radio-input">
                                    <span class="radio-label">I understand it</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="investment_familiarity" value="deep_understanding" class="radio-input">
                                    <span class="radio-label">I have a deep understanding</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label required">Have you worked with an investment adviser before?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="worked_with_adviser" value="yes" class="radio-input">
                                    <span class="radio-label">Yes</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="worked_with_adviser" value="no" class="radio-input">
                                    <span class="radio-label">No</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="worked_with_adviser" value="not_sure" class="radio-input">
                                    <span class="radio-label">I'm not sure</span>
                                </label>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label">What kinds of accounts would you like us to open for you?</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="account_types" value="not_sure" class="checkbox-input">
                                    <span class="checkbox-label">I'm not sure</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="account_types" value="transfer_existing" class="checkbox-input">
                                    <span class="checkbox-label">I'd like to transfer my existing accounts.</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="account_types" value="individual_taxable" class="checkbox-input">
                                    <span class="checkbox-label">Individual taxable account</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="account_types" value="roth_ira" class="checkbox-input">
                                    <span class="checkbox-label">Roth IRA</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="account_types" value="trust_account" class="checkbox-input">
                                    <span class="checkbox-label">Trust Account</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="account_types" value="corporate_account" class="checkbox-input">
                                    <span class="checkbox-label">Corporate Account</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="account_types" value="joint_account" class="checkbox-input">
                                    <span class="checkbox-label">Joint Account</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="account_types" value="high_yield_savings" class="checkbox-input">
                                    <span class="checkbox-label">High yield savings account</span>
                                </label>
                            </div>
                            <div class="garden-form-group mt-3">
                                <label class="form-label" for="account_types_other">Other:</label>
                                <textarea id="account_types_other" name="account_types_other" class="garden-input" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="form-navigation">
                            <button type="button" class="garden-action secondary" @click="prevStep()">Back</button>
                            <button type="button" class="garden-action primary" @click="nextStep()">Continue</button>
                        </div>
                    </div>
                </section>

                <!-- Section 7: Your Financial Team -->
                <section class="garden-panel form-section" data-step="7" x-show="currentStep === 7">
                    <div class="panel-header">YOUR FINANCIAL TEAM</div>
                    <div class="panel-content">
                        <div class="section-description">
                            <p>Long-term investing is our sole focus at Ethical Capital. This specialty makes us somewhat akin to a surgeon. We are happy to offer practical guidance about anything we can — and are always interested to know more about our clients' lives — but most of what we do comes down to renovating and reassembling portfolios.</p>
                            <p>This means over the course of the lifetime we hope to work together, you will have needs we can't fulfill. For instance, you may need:</p>
                            <ul>
                                <li>A financial planner to build out a detailed budget,</li>
                                <li>A money coach to help you get your hands around everything, or</li>
                                <li>A finance-informed therapist.</li>
                            </ul>
                            <p>We know those kinds of people, and love working alongside them to support our clients.</p>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" for="financial_team_coordinate">Is there someone (accountant, attorney, etc) you'd like us to coordinate with?</label>
                            <textarea id="financial_team_coordinate" name="financial_team_coordinate" class="garden-input" rows="3"></textarea>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label">Would you like us to refer you to a values-aligned professional with one or more of these characteristics?</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="professional_referrals" value="accountant" class="checkbox-input">
                                    <span class="checkbox-label">Accountant</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="professional_referrals" value="attorney" class="checkbox-input">
                                    <span class="checkbox-label">Attorney</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="professional_referrals" value="bookkeeper" class="checkbox-input">
                                    <span class="checkbox-label">Bookkeeper</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="professional_referrals" value="financial_planner" class="checkbox-input">
                                    <span class="checkbox-label">Financial planner</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="professional_referrals" value="insurance_agent" class="checkbox-input">
                                    <span class="checkbox-label">Insurance agent</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="professional_referrals" value="money_coach" class="checkbox-input">
                                    <span class="checkbox-label">Money Coach</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="professional_referrals" value="therapist" class="checkbox-input">
                                    <span class="checkbox-label">Therapist</span>
                                </label>
                            </div>
                            <div class="garden-form-group mt-3">
                                <label class="form-label" for="professional_referrals_other">Other:</label>
                                <textarea id="professional_referrals_other" name="professional_referrals_other" class="garden-input" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="garden-form-group">
                            <label class="form-label" for="anything_else">Is there anything else going on in your life you'd like to tell us about?</label>
                            <textarea id="anything_else" name="anything_else" class="garden-input" rows="4"></textarea>
                        </div>

                        <div class="form-navigation">
                            <button type="button" class="garden-action secondary" @click="prevStep()">Back</button>
                            <button type="button" class="garden-action primary" @click="nextStep()">Continue</button>
                        </div>
                    </div>
                </section>

                <!-- Section 8: Review & Submit -->
                <section class="garden-panel form-section" data-step="8" x-show="currentStep === 8">
                    <div class="panel-header">REVIEW & SUBMIT</div>
                    <div class="panel-content">
                        <div class="section-description">
                            <h3>That's it for now!</h3>
                            <p>We'll be in touch shortly!</p>
                            <p>In the meantime, you'll get a little something from Sloane in your inbox momentarily... a link to schedule an onboarding call.</p>
                            <p>Don't hesitate to reply directly to that email with any questions you may have, and welcome!</p>
                        </div>

                        <div class="garden-form-group">
                            <label class="checkbox-option">
                                <input type="checkbox" id="confirm_accuracy" name="confirm_accuracy" class="checkbox-input" required>
                                <span class="checkbox-label">I confirm that all information provided is accurate to the best of my knowledge.</span>
                            </label>
                        </div>

                        <div class="form-navigation">
                            <button type="button" class="garden-action secondary" @click="prevStep()">Back</button>
                            <button type="submit" class="garden-action primary" id="submitBtn">Submit Application</button>
                        </div>
                    </div>
                </section>

                <!-- Hidden honeypot field -->
                <input type="text" name="honeypot" style="position: absolute; left: -9999px; top: -9999px;" tabindex="-1" autocomplete="off">
                
                <!-- Turnstile hidden field -->
                <input type="hidden" name="cf_turnstile_response" value="">
                
                <!-- Cloudflare Turnstile before submit -->
                <div class="garden-form-group" x-show="currentStep === 8" style="margin-bottom: 1rem;">
                    <div class="cf-turnstile" 
                         data-sitekey="{{ TURNSTILE_SITE_KEY }}"
                         data-callback="onTurnstileSuccess"
                         data-expired-callback="onTurnstileExpired"
                         data-error-callback="onTurnstileError"></div>
                </div>
            </form>

            <!-- Thank You Message -->
            <section class="garden-panel thank-you-panel" id="thankYouMessage" style="display: none;">
                <div class="panel-header">APPLICATION SUBMITTED</div>
                <div class="panel-content">
                    <div class="thank-you-message">
                        <div class="success-icon">✓</div>
                        <h2>Thank You for Your Application!</h2>
                        <p>We've received your information and will review it shortly. You should receive a confirmation email within the next few minutes.</p>
                        <p>A member of our team will contact you within 1-2 business days to discuss the next steps in opening your account.</p>
                        <div class="next-steps">
                            <h3>What Happens Next?</h3>
                            <ul>
                                <li>Account review and approval (1-2 business days)</li>
                                <li>Schedule a consultation with your adviser</li>
                                <li>Fund your account and begin investing</li>
                                <li>Access your personalized investment dashboard</li>
                            </ul>
                        </div>
                        <a href="/" class="garden-action primary">Return to Homepage</a>
                    </div>
                </div>
            </section>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/onboarding-comprehensive.css' %}">
<style>
/* Emergency fix for invisible form borders - comprehensive override for all onboarding form fields */
html body .main-content .onboarding-page input[type="text"],
html body .main-content .onboarding-page input[type="email"],
html body .main-content .onboarding-page input[type="tel"],
html body .main-content .onboarding-page input[type="number"],
html body .main-content .onboarding-page input[type="date"],
html body .main-content .onboarding-page input[type="url"],
html body .main-content .onboarding-page input[type="password"],
html body .main-content .onboarding-page textarea,
html body .main-content .onboarding-page select,
html body .main-content .onboarding-page .garden-input,
html body .main-content .onboarding-page input,
html body .main-content input.garden-input,
/* Specific field IDs for all sections */
html body .main-content input#email,
html body .main-content input#first_name,
html body .main-content input#last_name,
html body .main-content input#middle_names,
html body .main-content input#preferred_name,
html body .main-content input#pronouns,
html body .main-content input#street_address,
html body .main-content input#apartment,
html body .main-content input#city,
html body .main-content input#state,
html body .main-content input#zip_code,
html body .main-content input#country,
html body .main-content input#phone_number,
html body .main-content input#birthday,
html body .main-content input#household_income,
html body .main-content input#liquid_assets,
html body .main-content input#portfolio_size,
html body .main-content input#annual_income,
html body .main-content input#net_worth,
html body .main-content input#investment_timeline,
html body .main-content input#risk_tolerance,
html body .main-content input#current_investments,
html body .main-content input#investment_goals,
html body .main-content input#employer_name,
html body .main-content input#job_title,
html body .main-content input#work_experience,
html body .main-content input#industry,
html body .main-content input#investment_experience,
html body .main-content input#previous_advisors,
html body .main-content input#referral_source,
html body .main-content input#specific_needs,
html body .main-content input#additional_comments,
html body .main-content textarea#additional_comments,
html body .main-content textarea#investment_goals,
html body .main-content textarea#specific_needs,
html body .main-content textarea {
    border: 1px solid #e5e7eb !important;
    border-color: #e5e7eb !important;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('alpine:init', () => {
    Alpine.data('onboardingForm', () => ({
        currentStep: 1,
        totalSteps: 8,
        submitting: false,
        addCoClient: false,
        stepNames: {
            1: 'About You',
            2: 'Your Co-Client',
            3: 'Contact Preferences',
            4: 'Risk Assessment',
            5: 'Values & Viewpoint',
            6: 'Financial Context',
            7: 'Your Financial Team',
            8: 'Review & Submit'
        },
        get actualTotalSteps() {
            return this.addCoClient ? 8 : 7;
        },
        get actualStepNumber() {
            if (!this.addCoClient && this.currentStep > 2) {
                return this.currentStep - 1;
            }
            return this.currentStep;
        },
        get progress() {
            return (this.actualStepNumber / this.actualTotalSteps) * 100;
        },
        get progressText() {
            return `Step ${this.actualStepNumber} of ${this.actualTotalSteps}: ${this.stepNames[this.currentStep]}`;
        },
        nextStep() {
            if (this.validateStep(this.currentStep)) {
                if (this.currentStep === 1 && this.addCoClient === false) {
                    this.currentStep = 3; // Skip co-client section
                } else if (this.currentStep < this.totalSteps) {
                    this.currentStep++;
                }
                window.scrollTo(0, 0);
            }
        },
        prevStep() {
            if (this.currentStep === 3 && this.addCoClient === false && this.currentStep > 1) {
                this.currentStep = 1; // Skip back over co-client section
            } else if (this.currentStep > 1) {
                this.currentStep--;
            }
            window.scrollTo(0, 0);
        },
        goToStep(targetStep) {
            // Allow going to previous steps or current step without validation
            if (targetStep <= this.currentStep) {
                this.currentStep = targetStep;
                window.scrollTo(0, 0);
            } else {
                // For future steps, validate current step first
                if (this.validateStep(this.currentStep)) {
                    this.currentStep = targetStep;
                    window.scrollTo(0, 0);
                }
            }
        },
        goToDisplayStep(displayStep) {
            // Convert display step number to actual step number
            let targetStep;
            if (this.addCoClient) {
                targetStep = displayStep;
            } else {
                // If no co-client, adjust step numbers (skip step 2)
                targetStep = displayStep >= 2 ? displayStep + 1 : displayStep;
            }
            this.goToStep(targetStep);
        },
        showValidationMessage(message, type = 'error') {
            // Remove any existing validation messages
            const existingMessage = document.querySelector('.validation-message');
            if (existingMessage) existingMessage.remove();

            // Create new validation message
            const messageDiv = document.createElement('div');
            messageDiv.className = `validation-message ${type}`;
            messageDiv.innerHTML = `
                <span class="validation-icon">${type === 'error' ? '⚠️' : '✓'}</span>
                <span class="validation-text">${message}</span>
            `;

            // Insert at top of current step
            const currentSection = document.querySelector(`[data-step='${this.currentStep}']`);
            const panelContent = currentSection.querySelector('.panel-content');
            panelContent.insertBefore(messageDiv, panelContent.firstChild);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) messageDiv.remove();
            }, 5000);
        },
        validateStep(step) {
            const section = document.querySelector(`[data-step='${step}']`);
            const requiredFields = section.querySelectorAll('[required]:not([x-show]):not([style*="display: none"])');
            let isValid = true;
            let errorFields = [];

            requiredFields.forEach(field => {
                let fieldValid = true;

                if (field.type === 'radio') {
                    fieldValid = section.querySelector(`input[name='${field.name}']:checked`) !== null;
                } else if (field.type === 'checkbox' && field.hasAttribute('required')) {
                    fieldValid = field.checked;
                } else {
                    fieldValid = field.value.trim() !== '';
                }

                if (!fieldValid) {
                    isValid = false;
                    field.classList.add('error');

                    // Get field label for error message
                    const label = field.closest('.garden-form-group')?.querySelector('label');
                    const fieldName = label ? label.textContent.replace('*', '').trim() : field.name;
                    errorFields.push(fieldName);
                } else {
                    field.classList.remove('error');
                }
            });

            if (!isValid) {
                const message = errorFields.length === 1
                    ? `Please complete: ${errorFields[0]}`
                    : `Please complete these required fields: ${errorFields.join(', ')}`;
                this.showValidationMessage(message, 'error');

                // Focus on first error field
                const firstErrorField = section.querySelector('.error');
                if (firstErrorField) {
                    firstErrorField.focus();
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            return isValid;
        }
    }));
});

// Turnstile callback functions
function onTurnstileSuccess(token) {
    // Store the token in the hidden field
    const hiddenField = document.querySelector('input[name="cf_turnstile_response"]');
    if (hiddenField) {
        hiddenField.value = token;
    }
    console.log('Turnstile verification successful');
}

function onTurnstileExpired() {
    // Clear the token when expired
    const hiddenField = document.querySelector('input[name="cf_turnstile_response"]');
    if (hiddenField) {
        hiddenField.value = '';
    }
    console.log('Turnstile token expired');
}

function onTurnstileError(error) {
    // Clear the token on error
    const hiddenField = document.querySelector('input[name="cf_turnstile_response"]');
    if (hiddenField) {
        hiddenField.value = '';
    }
    console.log('Turnstile error:', error);
}
</script>

<!-- Cloudflare Turnstile Script -->
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
{% endblock %}
