<!DOCTYPE html>
<!-- Template: base_tailwind.html - dark mode only - deployed at 2025-01-28 -->
<html lang="en" data-theme="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
            {% block title %}{{ page_title|default:"Ethical Capital" }}{% endblock %}
        </title>
        {% load static wagtailsettings_tags menu_tags %}
        {% get_settings "public_site.SiteConfiguration" as site_config %}
        <!-- Optimized font loading strategy -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Raleway:ital,wght@0,100..900;1,100..900&family=Outfit:wght@400;600;700;900&display=swap"
              rel="stylesheet" />
        <!-- Tailwind CSS Foundation -->
        <link rel="stylesheet" href="{% static 'css/dist/tailwind.min.css' %}?v=2" />
        <!-- Ethical Capital Design System - Replaces Garden UI dependencies and security fixes -->
        <link rel="stylesheet" href="{% static 'css/ethicic-design-system.css' %}?v=1" />
        <!-- Cross-Browser Compatibility Fixes -->
        <link rel="stylesheet" href="{% static 'css/browser-compatibility-fixes.css' %}?v=1" />
        <!-- Chromium-Specific Fixes (loaded last for highest specificity) -->
        <link rel="stylesheet" href="{% static 'css/chromium-specific-fixes.css' %}?v=1" />
        <!-- Content Security Policy for enhanced security -->
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://us.i.posthog.com https://*.i.posthog.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://us.i.posthog.com https://*.posthog.com; frame-ancestors 'none';">
        <!-- Meta tags for SEO and social sharing -->
        <meta name="description"
              content="{% block meta_description %}{% if page %}{{ page.search_description|default:site_config.meta_description|default:'Ethical Capital provides socially responsible investment advisory services with a focus on sustainable and ethical investing.' }}{% else %}{{ site_config.meta_description|default:'Ethical Capital provides socially responsible investment advisory services with a focus on sustainable and ethical investing.' }}{% endif %}{% endblock %}" />
        <meta name="keywords"
              content="{% block meta_keywords %}{{ site_config.meta_keywords|default:'ethical investing, sustainable investing, ESG investing, socially responsible investing, investment advisory' }}{% endblock %}" />
        <!-- Open Graph tags -->
        <meta property="og:title"
              content="{% block og_title %}{% if page %}{{ page.seo_title|default:page.title|default:'Ethical Capital' }}{% else %}Ethical Capital{% endif %}{% endblock %}" />
        <meta property="og:description"
              content="{% block og_description %}{% if page %}{{ page.search_description|default:site_config.meta_description }}{% else %}{{ site_config.meta_description }}{% endif %}{% endblock %}" />
        <meta property="og:url"
              content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}" />
        <meta property="og:type" content="{% block og_type %}website{% endblock %}" />
        <meta property="og:image"
              content="{% block og_image %}{% static 'images/og-default.svg' %}{% endblock %}" />
        <!-- Favicon -->
        <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}" />
        <!-- CSRF Token for JavaScript -->
        {% csrf_token %}
        <meta name="csrf-token" content="{{ csrf_token }}" />
        <!-- HTMX for server-driven interactivity - With SRI Hash for Security -->
        <script src="https://unpkg.com/htmx.org@1.9.11/dist/htmx.min.js" 
                integrity="sha384-0gxUXCCR8yv9FM2b+U3FDbsKthCI66oH5IA9fHppQq9DDMHuMauqq1ZHBpJxQ0J0"
                crossorigin="anonymous"></script>
        <!-- Alpine.js for lightweight client-side reactivity - With SRI Hash for Security -->
        <script defer 
                src="https://unpkg.com/alpinejs@3.14.1/dist/cdn.min.js"
                integrity="sha384-l8f0VcPi/M1iHPv8egOnY/15TDwqgbOR1anMIJWvU6nLRgZVLTLSaNqi/TOoT5Fh"
                crossorigin="anonymous"></script>
        {% block extra_css %}{% endblock %}
        <!-- PostHog Analytics -->
        <script>
            !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init Re Ms Fs Pe Rs Cs capture Ve calculateEventProperties Ds register register_once register_for_session unregister unregister_for_session zs getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty Ls As createPersonProfile Ns Is Us opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing is_capturing clear_opt_in_out_capturing Os debug I js getPageViewId captureTraceFeedback captureTraceMetric".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_iPeP4HP7NhtEKJmbwwFt65mjlVJjJb1MLe8RXYwIszc', {
                api_host: 'https://us.i.posthog.com',
                ui_host: 'https://us.posthog.com',
                person_profiles: 'identified_only', // GDPR compliant - only create profiles for identified users
                capture_pageview: true,
                capture_pageleave: true,
                autocapture: true,
                capture_performance: false, // Disabled for privacy - can expose sensitive timing data
                // Enable error tracking with privacy controls
                capture_exceptions: true,
                // Session recording with enhanced privacy controls
                session_recording: {
                    enabled: true,
                    maskAllInputs: true, // Mask all input fields by default
                    maskInputOptions: { 
                        password: true,
                        email: true,
                        credit_card: true,
                        ssn: true,
                        phone: true
                    },
                    maskTextSelector: '.sensitive-data, .pii-data, .financial-data', // Custom selectors for sensitive content
                    blockClass: 'ph-no-record', // Class to completely block elements from recording
                    ignoreClass: 'ph-ignore' // Class to ignore elements in autocapture
                },
                // Security: Only enable debug in development environments
                debug: (window.location.hostname === 'localhost' || 
                       window.location.hostname === '127.0.0.1' || 
                       window.location.hostname.includes('.local')) && 
                       !window.location.hostname.includes('ethicic') && 
                       !window.location.hostname.includes('.com'),
                // Privacy: Respect Do Not Track header
                respect_dnt: true,
                // Privacy: Cross-domain tracking disabled
                cross_subdomain_cookie: false,
                // Security: Secure cookie transmission
                secure_cookie: true,
                // Privacy: IP anonymization
                property_blacklist: ['$ip'], // Don't collect IP addresses
                // Error handling without exposing sensitive information
                on_xhr_error: function(error) {
                    if (typeof console !== 'undefined' && console.warn) {
                        console.warn('Analytics service unavailable');
                    }
                },
                loaded: function(posthog) {
                    // Only log success in development (check for localhost/debug environment)
                    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.hostname.includes('.local')) {
                        console.log('PostHog loaded successfully');
                    }
                    // PostHog will automatically capture exceptions - no need for explicit enableExceptionAutocapture
                    // Exception tracking is built into the standard PostHog functionality
                }
            })
            
            // PostHog will automatically track exceptions and errors as part of its standard functionality
            // Exception tracking is enabled by default in PostHog
        </script>
        <!-- All layout, typography, and text visibility fixes now consolidated in tailwind-consolidated.css -->
    </head>
    <body class="{% block body_class %}{% endblock %} block flex min-h-screen flex-col bg-gray-900 font-sans text-gray-100">
        <!-- Skip navigation links for screen readers -->
        <a href="#main-content"
           class="sr-only z-50 rounded bg-gray-900 px-4 py-2 text-white focus:not-sr-only focus:absolute focus:top-4 focus:left-4">
            Skip to main content
        </a>
        <!-- Site Notice -->
        <div class="bg-gray-800 border-b border-gray-600 text-center py-3 px-4">
            <div class="font-bold text-sm md:text-base text-white">🇵🇸 We stand with Palestine</div>
            <div class="text-xs mt-1 text-gray-400 font-mono">
                (and we're remodeling our website - please pardon our "dust" while work is underway).
                <a href="https://tidycal.com/ecic"
                   class="text-teal-400 hover:text-teal-300 underline"
                   target="_blank"
                   rel="noopener noreferrer">Click here to schedule a meeting</a>
                and
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdx1ex4pj5iYaj1v1Yxjt7iFbicqZbKWNuOZVyMlG8sKswbgQ/viewform?usp=header"
                   class="text-teal-400 hover:text-teal-300 underline"
                   target="_blank"
                   rel="noopener noreferrer">click here to become a client</a>
            </div>
        </div>
        <a href="#main-navigation"
           class="sr-only z-50 rounded bg-gray-900 px-4 py-2 text-white focus:not-sr-only focus:absolute focus:top-4 focus:left-32">
            Skip to navigation
        </a>
        <!-- ARIA live regions for announcements -->
        <div aria-live="polite"
             aria-atomic="true"
             class="sr-only"
             id="announcements"></div>
        <div aria-live="assertive"
             aria-atomic="true"
             class="sr-only"
             id="urgent-announcements"></div>
        <!-- Shared Header with Consistent Container Width -->
        <header class="border-b border-purple-800 bg-purple-900"
                role="banner"
                x-data="{ mobileMenuOpen: false }">
            <div class="container-ec">
                <div class="flex h-16 items-center justify-between">
                    
                    <!-- Logo/Brand - Always Visible -->
                    <div class="flex items-center flex-shrink-0">
                        <a href="/"
                           class="logo-container garden-header-logo text-white font-bold text-lg tracking-wide"
                           aria-label="Ethical Capital Home">
                            <span class="logo-text">ETHICAL</span>
                            <div class="logo-underline">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </a>
                    </div>

                    <!-- Desktop Navigation - Show at md+ breakpoint -->
                    <nav class="hidden md:flex md:items-center md:space-x-8 lg:space-x-10"
                         id="main-navigation"
                         aria-label="Main navigation">
                        {% main_menu max_levels=1 template="wagtailmenus/main_menu_tailwind.html" %}
                    </nav>

                    <!-- Desktop Actions - Responsive Sizing with better spacing -->
                    <div class="hidden md:flex md:items-center md:space-x-2 lg:space-x-3">
                        <!-- Search - Responsive Width -->
                        <div class="relative"
                             x-data="{ searchOpen: false, query: '', searching: false }"
                             @htmx:before-request="searching = true"
                             @htmx:after-request="searching = false">
                            <form method="get"
                                  action="/search/"
                                  class="relative"
                                  role="search">
                                <label for="search-input" class="sr-only">Search our website</label>
                                <input type="text"
                                       id="search-input"
                                       name="q"
                                       placeholder="Search..."
                                       class="w-24 md:w-32 lg:w-40 xl:w-48 rounded-lg border border-purple-700 bg-purple-800 px-3 py-2 pr-10 text-sm text-white placeholder-purple-300 focus:border-transparent focus:ring-2 focus:ring-purple-400 focus:outline-none"
                                       autocomplete="off"
                                       x-model="query"
                                       @focus="searchOpen = true"
                                       hx-get="/search/live/"
                                       hx-trigger="keyup changed delay:300ms"
                                       hx-target="#search-results" />
                                <button type="submit"
                                        class="absolute right-1 top-1/2 -translate-y-1/2 rounded bg-purple-600 p-1.5 text-white transition-colors hover:bg-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-400"
                                        aria-label="Submit search">
                                    <span x-show="searching" x-cloak class="animate-spin text-xs">⟳</span>
                                    <span x-show="!searching" class="text-xs">🔍</span>
                                </button>
                            </form>
                            <!-- Search results dropdown -->
                            <div id="search-results"
                                 class="absolute top-full left-0 z-50 mt-2 max-h-64 w-full overflow-y-auto rounded-lg border border-gray-600 bg-gray-800 shadow-lg"
                                 x-show="searchOpen && query.length > 0"
                                 @click.outside="searchOpen = false"
                                 x-transition
                                 x-cloak>
                                <!-- Results populated by HTMX -->
                            </div>
                        </div>
                        
                        <!-- Login Button - Compact -->
                        <a href="https://app.altruist.com/login"
                           class="flex items-center rounded-lg border border-gray-600 bg-gray-700 px-2 py-2 text-xs lg:text-sm text-white transition-colors hover:border-gray-500 hover:bg-gray-600 whitespace-nowrap"
                           target="_blank"
                           rel="noopener"
                           aria-label="Client login">
                            Login
                        </a>
                        
                        <!-- CTA Button - Compact -->
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSdx1ex4pj5iYaj1v1Yxjt7iFbicqZbKWNuOZVyMlG8sKswbgQ/viewform?usp=header"
                           class="btn-ec-secondary px-2 lg:px-3 py-2 text-xs lg:text-sm font-semibold rounded-lg transition-all duration-200 whitespace-nowrap"
                           target="_blank"
                           rel="noopener">
                            Get Started
                        </a>
                    </div>

                    <!-- Mobile menu button -->
                    <div class="flex items-center md:hidden">
                        <button type="button"
                                class="inline-flex items-center justify-center rounded-md p-2 text-white hover:bg-purple-800 hover:text-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-purple-500"
                                aria-controls="mobile-menu"
                                aria-expanded="false"
                                @click="mobileMenuOpen = !mobileMenuOpen">
                            <span class="sr-only">Open main menu</span>
                            <!-- Hamburger icon -->
                            <svg class="h-6 w-6" x-show="!mobileMenuOpen" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                            </svg>
                            <!-- Close icon -->
                            <svg class="h-6 w-6" x-show="mobileMenuOpen" x-cloak fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile menu -->
            <div class="md:hidden" 
                 x-show="mobileMenuOpen" 
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 id="mobile-menu"
                 x-cloak>
                <div class="space-y-1 px-2 pb-3 pt-2 bg-purple-800 border-t border-purple-700">
                    <!-- Mobile navigation items -->
                    {% main_menu max_levels=1 template="wagtailmenus/main_menu_mobile_tailwind.html" %}
                    
                    <!-- Mobile search -->
                    <div class="px-3 py-2">
                        <form method="get" action="/search/" class="flex">
                            <input type="text"
                                   name="q"
                                   placeholder="Search..."
                                   class="flex-1 rounded-l-lg border border-purple-600 bg-purple-700 px-3 py-2 text-sm text-white placeholder-purple-300 focus:border-purple-400 focus:outline-none focus:ring-1 focus:ring-purple-400" />
                            <button type="submit"
                                    class="rounded-r-lg bg-purple-600 px-3 py-2 text-white hover:bg-purple-500 focus:outline-none focus:ring-1 focus:ring-purple-400">
                                🔍
                            </button>
                        </form>
                    </div>
                    
                    <!-- Mobile login/CTA -->
                    <div class="px-3 py-2 space-y-2">
                        <a href="https://app.altruist.com/login"
                           class="block rounded-lg border border-gray-600 bg-gray-700 px-3 py-2 text-center text-sm text-white"
                           target="_blank">
                            Login
                        </a>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSdx1ex4pj5iYaj1v1Yxjt7iFbicqZbKWNuOZVyMlG8sKswbgQ/viewform?usp=header"
                           class="btn-ec-secondary block px-3 py-2 text-center text-sm font-semibold rounded-lg"
                           target="_blank">
                            Get Started
                        </a>
                    </div>
                </div>
            </div>
        </header>
        <!-- Main Content -->
        <main id="main-content" class="flex-1 pt-8 pb-24" role="main">
            {% block content %}{% endblock %}
        </main>
        <!-- Shared Footer -->
        <footer class="garden-footer-shared border-t border-gray-600 bg-gray-800 mt-8"
                style="padding-top: 4rem !important">
            <div class="garden-footer-container pb-8">
                <div class="garden-footer-grid footer-grid grid grid-cols-1 gap-8 sm:grid-cols-2 md:grid-cols-5">
                    <!-- Company Info -->
                    <div class="garden-footer-section garden-footer-company">
                        <a href="/"
                           class="logo-container mb-4"
                           aria-label="Ethical Capital Home">
                            <span class="logo-text">ETHICAL</span>
                            <div class="logo-underline">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </a>
                        <p class="garden-footer-company-description">
                            Socially responsible investment advisory services with a focus on sustainable and ethical investing.
                        </p>
                        <div class="garden-footer-company-legal">
                            <p>Utah Registered Investment Adviser</p>
                            <p>CRD #316032</p>
                        </div>
                    </div>
                    <!-- Company -->
                    <div class="garden-footer-section">
                        <h3 class="garden-footer-section-title">Company</h3>
                        <ul class="garden-footer-section-list">
                            <li>
                                <a href="/about/"
                                   class="garden-footer-section-link">About</a>
                            </li>
                            <li>
                                <a href="/media/"
                                   class="garden-footer-section-link">Media</a>
                            </li>
                            <li>
                                <a href="/disclosures/"
                                   class="garden-footer-section-link">Disclosures</a>
                            </li>
                            <li>
                                <a href="/accessibility/"
                                   class="garden-footer-section-link">Accessibility</a>
                            </li>
                            <li>
                                <a href="https://reports.adviserinfo.sec.gov/reports/ADV/316032/PDF/316032.pdf"
                                   class="garden-footer-section-link"
                                   target="_blank"
                                   rel="noopener noreferrer">Form ADV</a>
                            </li>
                        </ul>
                    </div>
                    <!-- Resources -->
                    <div class="garden-footer-section">
                        <h3 class="garden-footer-section-title">Resources</h3>
                        <ul class="garden-footer-section-list">
                            <li>
                                <a href="/blog/"
                                   class="text-gray-400 transition-colors hover:text-purple-400">Blog</a>
                            </li>
                            <li>
                                <a href="/encyclopedia/"
                                   class="text-gray-400 transition-colors hover:text-purple-400">Encyclopedia</a>
                            </li>
                            <li>
                                <a href="/faq/"
                                   class="text-gray-400 transition-colors hover:text-purple-400">FAQ</a>
                            </li>
                        </ul>
                    </div>
                    <!-- Investing -->
                    <div>
                        <h3 class="mb-4 heading-h3 text-sm text-purple-400 uppercase">Investing</h3>
                        <ul class="space-y-2 text-sm">
                            <li>
                                <a href="/solutions/"
                                   class="text-gray-400 transition-colors hover:text-purple-400">Solutions</a>
                            </li>
                            <li>
                                <a href="/pricing/"
                                   class="text-gray-400 transition-colors hover:text-purple-400">Pricing</a>
                            </li>
                            <li>
                                <a href="/process/"
                                   class="text-gray-400 transition-colors hover:text-purple-400">Process</a>
                            </li>
                        </ul>
                    </div>
                    <!-- Connect -->
                    <div>
                        <h3 class="mb-4 heading-h3 text-sm text-purple-400 uppercase">Connect</h3>
                        <ul class="space-y-2 text-sm">
                            <li>
                                <a href="/contact/"
                                   class="text-gray-400 transition-colors hover:text-purple-400">Contact</a>
                            </li>
                            <li>
                                <a href="/newsletter/"
                                   class="text-gray-400 transition-colors hover:text-purple-400">Newsletter</a>
                            </li>
                            <li>
                                <a href="https://www.linkedin.com/company/ethicalcapitalcollective/"
                                   class="text-gray-400 transition-colors hover:text-purple-400"
                                   target="_blank"
                                   rel="noopener noreferrer"
                                   aria-label="Visit Ethical Capital Collaborative on LinkedIn">LinkedIn</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="mt-12 border-t border-gray-600 pt-8 pb-4 text-center">
                    <p class="text-xs text-gray-500">© {{ "now"|date:"Y" }} Ethical Capital. All rights reserved.</p>
                </div>
            </div>
        </footer>
        
        <!-- Cross-Browser Compatibility JavaScript -->
        <script src="{% static 'js/browser-compatibility.js' %}?v=1"></script>
    </body>
</html>
