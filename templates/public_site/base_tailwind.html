<!DOCTYPE html>
<html lang="en" data-theme="{{ current_theme|default:'light' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ page_title|default:"Ethical Capital" }}{% endblock %}</title>

    {% load static wagtailsettings_tags menu_tags %}
    {% get_settings "public_site.SiteConfiguration" as site_config %}

    <!-- Optimized font loading strategy -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="{% static 'css/garden-ui-tokens.css' %}?v=1">
    <link rel="stylesheet" href="{% static 'css/dist/tailwind.min.css' %}?v=1">

    <!-- Meta tags for SEO and social sharing -->
    <meta name="description" content="{% block meta_description %}{% if page %}{{ page.search_description|default:site_config.meta_description|default:'Ethical Capital provides socially responsible investment advisory services with a focus on sustainable and ethical investing.' }}{% else %}{{ site_config.meta_description|default:'Ethical Capital provides socially responsible investment advisory services with a focus on sustainable and ethical investing.' }}{% endif %}{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}{{ site_config.meta_keywords|default:'ethical investing, sustainable investing, ESG investing, socially responsible investing, investment advisory' }}{% endblock %}">

    <!-- Open Graph tags -->
    <meta property="og:title" content="{% block og_title %}{% if page %}{{ page.seo_title|default:page.title|default:'Ethical Capital' }}{% else %}Ethical Capital{% endif %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% if page %}{{ page.search_description|default:site_config.meta_description }}{% else %}{{ site_config.meta_description }}{% endif %}{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% static 'images/og-default.svg' %}{% endblock %}">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}">

    <!-- CSRF Token for JavaScript -->
    {% csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token }}">

    <!-- HTMX for server-driven interactivity -->
    <script src="https://unpkg.com/htmx.org@1.9.11"></script>

    <!-- Alpine.js for lightweight client-side reactivity -->
    <script defer src="https://unpkg.com/alpinejs@3.13.7/dist/cdn.min.js"></script>

    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen flex flex-col {% block body_class %}{% endblock %}">
    <!-- Skip navigation links for screen readers -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-purple-600 text-white px-4 py-2 rounded z-50">Skip to main content</a>
    <a href="#main-navigation" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-32 bg-purple-600 text-white px-4 py-2 rounded z-50">Skip to navigation</a>

    <!-- ARIA live regions for announcements -->
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="announcements"></div>
    <div aria-live="assertive" aria-atomic="true" class="sr-only" id="urgent-announcements"></div>

    <!-- Tailwind Navigation Header -->
    <header class="bg-purple-900 border-b border-purple-800 relative z-40" role="banner" x-data="{ mobileMenuOpen: false }">
        <div class="container-ec">
            <div class="flex items-center justify-between py-4">
                <!-- Left: Brand and Navigation -->
                <div class="flex items-center space-x-8">
                    <!-- Brand -->
                    <a href="/" class="font-mono text-lg font-semibold text-white hover:text-purple-200 transition-colors" aria-label="Ethical Capital Home">
                        {{ site_config.company_name|default:"ETHICAL CAPITAL" }}
                    </a>

                    <!-- Desktop Navigation -->
                    <nav class="hidden md:flex space-x-6" id="main-navigation">
                        {% main_menu max_levels=1 template="wagtailmenus/main_menu_tailwind.html" %}
                    </nav>
                </div>

                <!-- Right: Search, Login, Mobile Menu -->
                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <div class="hidden md:block" x-data="{ searchOpen: false, query: '', searching: false }"
                         @htmx:before-request="searching = true"
                         @htmx:after-request="searching = false">
                        <form method="get" action="/search/" class="relative" role="search" id="search">
                            <label for="search-input" class="sr-only">Search our website</label>
                            <input type="text"
                                   id="search-input"
                                   name="q"
                                   placeholder="Search..."
                                   class="bg-purple-800 border border-purple-700 rounded-lg px-4 py-2 pr-10 text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent w-64"
                                   aria-label="Search our website"
                                   autocomplete="off"
                                   x-model="query"
                                   @focus="searchOpen = true"
                                   hx-get="/search/live/"
                                   hx-trigger="keyup changed delay:300ms"
                                   hx-target="#search-results">
                            <button type="submit"
                                    class="absolute right-2 top-1/2 transform -translate-y-1/2 text-purple-300 hover:text-white"
                                    aria-label="Submit search">
                                <span x-show="searching" x-cloak class="animate-spin">‚ü≥</span>
                                <span x-show="!searching">üîç</span>
                            </button>
                        </form>

                        <!-- Search results dropdown -->
                        <div id="search-results"
                             class="absolute top-full left-0 mt-2 w-full bg-gray-800 border border-gray-600 rounded-lg shadow-lg max-h-64 overflow-y-auto z-50"
                             x-show="searchOpen && query.length > 0"
                             @click.outside="searchOpen = false"
                             x-transition
                             x-cloak>
                            <!-- Results populated by HTMX -->
                        </div>
                    </div>

                    <!-- Login Dropdown -->
                    <div class="hidden md:block relative" x-data="{ open: false }">
                        <button class="flex items-center space-x-1 px-3 py-2 rounded-lg border border-purple-700 hover:border-purple-600 bg-purple-800 hover:bg-purple-700 text-white transition-colors"
                                @click="open = !open"
                                @click.outside="open = false"
                                aria-label="Login options">
                            <span>Login</span>
                            <span class="text-xs" :class="{ 'rotate-180': open }">‚ñº</span>
                        </button>

                        <div class="absolute right-0 mt-2 w-64 bg-gray-800 border border-gray-600 rounded-lg shadow-lg z-50"
                             x-show="open"
                             x-transition
                             @click="open = false"
                             x-cloak>
                            <a href="/garden/" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-700 rounded-t-lg transition-colors">
                                <span class="text-2xl">üå±</span>
                                <div>
                                    <div class="font-mono text-sm text-purple-400">Garden Login</div>
                                    <div class="text-xs text-gray-400">Research platform access</div>
                                </div>
                            </a>
                            <a href="https://app.altruist.com/login" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-700 rounded-b-lg transition-colors" target="_blank" rel="noopener">
                                <span class="text-2xl">üë§</span>
                                <div>
                                    <div class="font-mono text-sm text-purple-400">Client Login</div>
                                    <div class="text-xs text-gray-400">Portfolio access via Altruist</div>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Mobile menu toggle -->
                    <button class="md:hidden flex flex-col space-y-1 p-2"
                            @click="mobileMenuOpen = true"
                            aria-label="Open navigation menu">
                        <span class="block w-6 h-0.5 bg-white"></span>
                        <span class="block w-6 h-0.5 bg-white"></span>
                        <span class="block w-6 h-0.5 bg-white"></span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu Overlay -->
        <div class="fixed inset-0 bg-black bg-opacity-50 z-50 md:hidden"
             x-show="mobileMenuOpen"
             @click="mobileMenuOpen = false"
             x-transition
             x-cloak>
        </div>

        <!-- Mobile Menu Panel -->
        <div class="fixed top-0 right-0 h-full w-80 bg-gray-800 border-l border-gray-600 z-50 md:hidden transform transition-transform"
             x-show="mobileMenuOpen"
             x-transition:enter="transition-transform duration-300"
             x-transition:enter-start="translate-x-full"
             x-transition:enter-end="translate-x-0"
             x-transition:leave="transition-transform duration-300"
             x-transition:leave-start="translate-x-0"
             x-transition:leave-end="translate-x-full"
             x-cloak>

            <!-- Mobile menu header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-600">
                <span class="font-mono text-lg text-white">Menu</span>
                <button @click="mobileMenuOpen = false" class="text-gray-400 hover:text-white">
                    <span class="sr-only">Close menu</span>
                    ‚úï
                </button>
            </div>

            <!-- Mobile navigation -->
            <nav class="p-4 space-y-4">
                {% main_menu max_levels=1 template="wagtailmenus/main_menu_mobile_tailwind.html" %}
            </nav>

            <!-- Mobile search -->
            <div class="p-4 border-t border-gray-600">
                <form method="get" action="/search/" role="search">
                    <input type="text" name="q" placeholder="Search..."
                           class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-400">
                </form>
            </div>

            <!-- Mobile login links -->
            <div class="p-4 border-t border-gray-600 space-y-3">
                <a href="/garden/" class="flex items-center space-x-3 p-3 rounded-lg bg-gray-700 hover:bg-gray-600">
                    <span class="text-xl">üå±</span>
                    <div>
                        <div class="font-mono text-sm text-purple-400">Garden Login</div>
                        <div class="text-xs text-gray-400">Research platform</div>
                    </div>
                </a>
                <a href="https://app.altruist.com/login" class="flex items-center space-x-3 p-3 rounded-lg bg-gray-700 hover:bg-gray-600" target="_blank">
                    <span class="text-xl">üë§</span>
                    <div>
                        <div class="font-mono text-sm text-purple-400">Client Login</div>
                        <div class="text-xs text-gray-400">Portfolio access</div>
                    </div>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-1" role="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-600 mt-auto">
        <div class="container-ec py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Company Info -->
                <div>
                    <h3 class="font-mono text-sm uppercase text-purple-400 mb-4">Ethical Capital</h3>
                    <p class="text-sm text-gray-400 mb-4">
                        Socially responsible investment advisory services with a focus on sustainable and ethical investing.
                    </p>
                    <div class="text-xs text-gray-500">
                        <p>Investment Adviser Representative</p>
                        <p>CRD: 7114756 | SEC: 801-120708</p>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h3 class="font-mono text-sm uppercase text-purple-400 mb-4">Quick Links</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/about/" class="text-gray-400 hover:text-purple-400 transition-colors">About</a></li>
                        <li><a href="/process/" class="text-gray-400 hover:text-purple-400 transition-colors">Process</a></li>
                        <li><a href="/blog/" class="text-gray-400 hover:text-purple-400 transition-colors">Blog</a></li>
                        <li><a href="/contact/" class="text-gray-400 hover:text-purple-400 transition-colors">Contact</a></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div>
                    <h3 class="font-mono text-sm uppercase text-purple-400 mb-4">Legal</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/privacy/" class="text-gray-400 hover:text-purple-400 transition-colors">Privacy Policy</a></li>
                        <li><a href="/terms/" class="text-gray-400 hover:text-purple-400 transition-colors">Terms of Service</a></li>
                        <li><a href="/disclosures/" class="text-gray-400 hover:text-purple-400 transition-colors">Disclosures</a></li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-600 mt-8 pt-8 text-center">
                <p class="text-xs text-gray-500">
                    ¬© {{ "now"|date:"Y" }} Ethical Capital. All rights reserved.
                </p>
            </div>
        </div>
    </footer>
</body>
</html>
