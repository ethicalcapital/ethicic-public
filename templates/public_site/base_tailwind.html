<!doctype html>
<!-- Template: base_tailwind.html with theme toggle - deployed at 2025-01-27 -->
<html lang="en" data-theme="{{ current_theme|default:'light' }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}{{ page_title|default:"Ethical Capital" }}{% endblock %}</title>

    {% load static wagtailsettings_tags menu_tags %}
    {% get_settings "public_site.SiteConfiguration" as site_config %}

    <!-- Optimized font loading strategy -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS with Ethical Capital Design System -->
    <link rel="stylesheet" href="{% static 'css/dist/tailwind.min.css' %}?v=2" />

    <!-- Enhanced Typography using Tailwind CSS -->
    <style>
      .prose {
        @apply text-slate-700 dark:text-slate-300 max-w-none text-lg leading-relaxed font-normal tracking-tight;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }

      .prose > * + * {
        @apply mt-7;
      }

      /* Brand-Aligned Headers */
      .prose h1,
      .prose h2,
      .prose h3,
      .prose h4,
      .prose h5,
      .prose h6 {
        @apply text-slate-900 dark:text-slate-100 font-bold leading-tight tracking-tighter font-sans scroll-mt-8;
      }

      .prose h1 {
        @apply text-4xl mt-0 mb-4 bg-gradient-to-r from-teal-400 to-purple-600 bg-clip-text text-transparent;
      }

      .prose h2 {
        @apply text-3xl mt-10 mb-3 relative pb-2;
      }

      .prose h2::after {
        @apply absolute bottom-0 left-0 w-12 h-1 bg-gradient-to-r from-teal-400 to-purple-600 rounded-full;
        content: "";
      }

      .prose h3 {
        @apply text-2xl mt-8 mb-2 text-purple-900 dark:text-teal-400;
      }

      .prose h4 {
        @apply text-xl mt-7 mb-2 font-semibold;
      }

      /* Enhanced Text Elements */
      .prose p {
        @apply mb-6 text-justify hyphens-auto;
      }

      .prose p:first-of-type {
        @apply text-xl font-medium text-slate-800 dark:text-slate-200 leading-relaxed;
      }

      .prose a {
        @apply text-purple-900 dark:text-teal-400 no-underline border-b-2 border-purple-200 dark:border-teal-600 transition-all duration-300 font-medium hover:text-teal-600 dark:hover:text-teal-300 hover:border-teal-400 hover:bg-teal-50 dark:hover:bg-teal-900/20 hover:px-1 hover:-mx-1 hover:rounded;
      }

      .prose strong {
        @apply font-semibold text-slate-900 dark:text-slate-100 bg-gradient-to-r from-purple-50 to-teal-50 dark:from-purple-900/20 dark:to-teal-900/20 px-1 rounded;
      }

      .prose em {
        @apply italic text-slate-600 dark:text-slate-400;
      }

      /* Beautiful Blockquotes */
      .prose blockquote {
        @apply border-none bg-gradient-to-r from-teal-50/80 to-purple-50/60 dark:from-teal-900/20 dark:to-purple-900/20 p-8 my-10 italic text-lg leading-relaxed text-slate-600 dark:text-slate-300 rounded-xl relative shadow-lg shadow-teal-200/50 dark:shadow-teal-900/20;
      }

      .prose blockquote::before {
        @apply absolute -top-2 left-5 text-6xl text-teal-300 dark:text-teal-600 leading-none;
        content: '"';
        font-family: Georgia, serif;
      }

      /* Lists */
      .prose ul,
      .prose ol {
        @apply pl-0 my-8;
      }

      .prose ul li,
      .prose ol li {
        @apply relative pl-8 my-4 leading-relaxed;
      }

      .prose ul li::before {
        @apply absolute left-0 top-3 w-1.5 h-1.5 bg-gradient-to-r from-teal-400 to-purple-600 rounded-full;
        content: "";
      }

      .prose ol {
        counter-reset: item;
      }

      .prose ol li::before {
        @apply absolute left-0 top-0 w-6 h-6 bg-gradient-to-r from-teal-400 to-purple-600 text-white rounded-full flex items-center justify-center text-sm font-semibold;
        content: counter(item);
        counter-increment: item;
      }

      /* Code */
      .prose code {
        @apply bg-gradient-to-r from-teal-50 to-purple-50 dark:from-teal-900/30 dark:to-purple-900/30 text-purple-900 dark:text-teal-400 px-2 py-1 rounded text-sm border border-teal-200 dark:border-teal-700;
        font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Monaco, Consolas, monospace;
      }

      .prose pre {
        @apply bg-gradient-to-r from-slate-800 to-slate-900 text-slate-200 p-8 rounded-xl overflow-x-auto text-sm leading-relaxed my-10 shadow-2xl border border-teal-200/20;
      }

      .prose pre code {
        @apply bg-transparent p-0 text-inherit border-none text-sm;
      }

      /* Images & Tables */
      .prose img {
        @apply rounded-xl shadow-xl my-10 transition-transform duration-300 hover:-translate-y-1 hover:shadow-2xl;
      }

      .prose table {
        @apply w-full border-separate border-spacing-0 my-10 bg-white dark:bg-slate-800 rounded-xl overflow-hidden shadow-lg border border-teal-200/20;
      }

      .prose th,
      .prose td {
        @apply px-5 py-4 text-left border-b border-teal-200/20;
      }

      .prose th {
        @apply bg-gradient-to-r from-teal-50 to-purple-50 dark:from-teal-900/30 dark:to-purple-900/30 font-semibold text-slate-900 dark:text-slate-100 text-sm uppercase tracking-wider;
      }

      .prose tbody tr:hover {
        @apply bg-teal-50/50 dark:bg-teal-900/10;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .prose {
          @apply text-base max-w-full;
        }

        .prose h1 {
          @apply text-3xl;
        }
        .prose h2 {
          @apply text-2xl;
        }
        .prose h3 {
          @apply text-xl;
        }

        .prose blockquote {
          @apply p-6 my-8;
        }

        .prose pre {
          @apply p-6 my-8;
        }

        .prose ul li,
        .prose ol li {
          @apply pl-6;
        }
      }
    </style>

    <!-- Meta tags for SEO and social sharing -->
    <meta
      name="description"
      content="{% block meta_description %}{% if page %}{{ page.search_description|default:site_config.meta_description|default:'Ethical Capital provides socially responsible investment advisory services with a focus on sustainable and ethical investing.' }}{% else %}{{ site_config.meta_description|default:'Ethical Capital provides socially responsible investment advisory services with a focus on sustainable and ethical investing.' }}{% endif %}{% endblock %}"
    />
    <meta
      name="keywords"
      content="{% block meta_keywords %}{{ site_config.meta_keywords|default:'ethical investing, sustainable investing, ESG investing, socially responsible investing, investment advisory' }}{% endblock %}"
    />

    <!-- Open Graph tags -->
    <meta
      property="og:title"
      content="{% block og_title %}{% if page %}{{ page.seo_title|default:page.title|default:'Ethical Capital' }}{% else %}Ethical Capital{% endif %}{% endblock %}"
    />
    <meta
      property="og:description"
      content="{% block og_description %}{% if page %}{{ page.search_description|default:site_config.meta_description }}{% else %}{{ site_config.meta_description }}{% endif %}{% endblock %}"
    />
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}" />
    <meta property="og:type" content="{% block og_type %}website{% endblock %}" />
    <meta property="og:image" content="{% block og_image %}{% static 'images/og-default.svg' %}{% endblock %}" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{% static 'favicon.svg' %}" />

    <!-- CSRF Token for JavaScript -->
    {% csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token }}" />

    <!-- HTMX for server-driven interactivity -->
    <script src="https://unpkg.com/htmx.org@1.9.11"></script>

    <!-- Alpine.js for lightweight client-side reactivity -->
    <script defer src="https://unpkg.com/alpinejs@3.13.7/dist/cdn.min.js"></script>

    {% block extra_css %}{% endblock %}

    <!-- Page width fix: 68% max-width for desktop -->
    <style>
      .container-ec {
        max-width: 68vw;
        margin: 0 auto;
        padding: 0 1rem;
      }
      @media (max-width: 768px) {
        .container-ec {
          max-width: 95vw;
        }
      }
    </style>
  </head>
  <body
    class="bg-gray-900 text-gray-100 font-sans min-h-screen flex flex-col {% block body_class %}{% endblock %}"
  >
    <!-- Skip navigation links for screen readers -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-gray-900 text-white px-4 py-2 rounded z-50"
    >
      Skip to main content
    </a>
    <a
      href="#main-navigation"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-32 bg-gray-900 text-white px-4 py-2 rounded z-50"
    >
      Skip to navigation
    </a>

    <!-- ARIA live regions for announcements -->
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="announcements"></div>
    <div aria-live="assertive" aria-atomic="true" class="sr-only" id="urgent-announcements"></div>

    <!-- Tailwind Navigation Header -->
    <header
      class="bg-purple-900 dark:bg-purple-900 border-b border-purple-800 dark:border-purple-800 relative z-40"
      role="banner"
      x-data="{ mobileMenuOpen: false }"
    >
      <div class="container-ec">
        <div class="flex items-center justify-between py-4">
          <!-- Left: Brand and Navigation -->
          <div class="flex items-center space-x-8">
            <!-- Brand -->
            <a
              href="/"
              class="font-mono text-lg font-semibold text-white hover:text-purple-200 transition-colors"
              aria-label="Ethical Capital Home"
            >
              {{ site_config.company_name|default:"ETHICAL CAPITAL" }}
            </a>

            <!-- Desktop Navigation -->
            <nav class="hidden md:flex space-x-6" id="main-navigation">
              {% main_menu max_levels=1 template="wagtailmenus/main_menu_tailwind.html" %}
            </nav>
          </div>

          <!-- Right: Search, Login, Mobile Menu -->
          <div class="flex items-center space-x-4">
            <!-- Search -->
            <div
              class="hidden md:block"
              x-data="{ searchOpen: false, query: '', searching: false }"
              @htmx:before-request="searching = true"
              @htmx:after-request="searching = false"
            >
              <form method="get" action="/search/" class="relative" role="search" id="search">
                <label for="search-input" class="sr-only">Search our website</label>
                <input
                  type="text"
                  id="search-input"
                  name="q"
                  placeholder="Search..."
                  class="bg-purple-800 border border-purple-700 rounded-lg px-4 py-2 pr-10 text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent w-64"
                  aria-label="Search our website"
                  autocomplete="off"
                  x-model="query"
                  @focus="searchOpen = true"
                  hx-get="/search/live/"
                  hx-trigger="keyup changed delay:300ms"
                  hx-target="#search-results"
                />
                <button
                  type="submit"
                  class="absolute right-2 top-1/2 transform -translate-y-1/2 text-purple-300 hover:text-white"
                  aria-label="Submit search"
                >
                  <span x-show="searching" x-cloak class="animate-spin">⟳</span>
                  <span x-show="!searching">🔍</span>
                </button>
              </form>

              <!-- Search results dropdown -->
              <div
                id="search-results"
                class="absolute top-full left-0 mt-2 w-full bg-gray-800 border border-gray-600 rounded-lg shadow-lg max-h-64 overflow-y-auto z-50"
                x-show="searchOpen && query.length > 0"
                @click.outside="searchOpen = false"
                x-transition
                x-cloak
              >
                <!-- Results populated by HTMX -->
              </div>
            </div>

            <!-- Login Dropdown -->
            <div class="hidden md:block relative" x-data="{ open: false }">
              <button
                class="flex items-center space-x-1 px-3 py-2 rounded-lg border border-gray-600 hover:border-gray-500 bg-gray-700 hover:bg-gray-600 text-white transition-colors"
                @click="open = !open"
                @click.outside="open = false"
                aria-label="Login options"
              >
                <span>Login</span>
                <span class="text-xs" :class="{ 'rotate-180': open }">▼</span>
              </button>

              <div
                class="absolute right-0 mt-2 w-64 bg-gray-800 border border-gray-600 rounded-lg shadow-lg z-50"
                x-show="open"
                x-transition
                @click="open = false"
                x-cloak
              >
                <a
                  href="/garden/"
                  class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-700 rounded-t-lg transition-colors"
                >
                  <span class="text-2xl">🌱</span>
                  <div>
                    <div class="font-mono text-sm text-purple-400">Garden Login</div>
                    <div class="text-xs text-gray-400">Research platform access</div>
                  </div>
                </a>
                <a
                  href="https://app.altruist.com/login"
                  class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-700 rounded-b-lg transition-colors"
                  target="_blank"
                  rel="noopener"
                >
                  <span class="text-2xl">👤</span>
                  <div>
                    <div class="font-mono text-sm text-purple-400">Client Login</div>
                    <div class="text-xs text-gray-400">Portfolio access via Altruist</div>
                  </div>
                </a>
              </div>
            </div>

            <!-- CTA Button -->
            <a href="/onboarding/" class="btn-ec-primary" aria-label="Get started with Ethical Capital">Get Started</a>

            <!-- Theme Toggle -->
            <button
              class="p-2 rounded-lg border border-gray-600 hover:border-gray-500 bg-gray-700 hover:bg-gray-600 text-white transition-colors"
              x-data="{
                                isDark: false,
                                init() {
                                    // Initialize from current DOM state or localStorage
                                    const currentTheme = document.documentElement.getAttribute('data-theme');
                                    const savedTheme = localStorage.getItem('theme');

                                    // Priority: saved theme > current DOM theme > default light
                                    const theme = savedTheme || currentTheme || 'light';
                                    this.isDark = theme === 'dark';

                                    // Apply the theme to ensure consistency
                                    document.documentElement.setAttribute('data-theme', theme);
                                    localStorage.setItem('theme', theme);
                                },
                                toggle() {
                                    this.isDark = !this.isDark;
                                    const theme = this.isDark ? 'dark' : 'light';
                                    document.documentElement.setAttribute('data-theme', theme);
                                    localStorage.setItem('theme', theme);

                                    // Send to server to persist
                                    fetch('/api/theme/set/', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'X-CSRFToken': document.querySelector('[name=csrf-token]')?.content || ''
                                        },
                                        body: JSON.stringify({ theme })
                                    }).catch(e => console.log('Theme save failed:', e));
                                }
                            }"
              @click="toggle()"
              aria-label="Toggle light/dark theme"
            >
              <span x-text="isDark ? '🌙' : '☀️'"></span>
            </button>

            <!-- Mobile menu toggle -->
            <button
              class="md:hidden flex flex-col space-y-1 p-2"
              @click="mobileMenuOpen = true"
              aria-label="Open navigation menu"
            >
              <span class="block w-6 h-0.5 bg-white"></span>
              <span class="block w-6 h-0.5 bg-white"></span>
              <span class="block w-6 h-0.5 bg-white"></span>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile Menu Overlay -->
      <div
        class="fixed inset-0 bg-black bg-opacity-50 z-50 md:hidden"
        x-show="mobileMenuOpen"
        @click="mobileMenuOpen = false"
        x-transition
        x-cloak
      ></div>

      <!-- Mobile Menu Panel -->
      <div
        class="fixed top-0 right-0 h-full w-80 bg-gray-800 border-l border-gray-600 z-50 md:hidden transform transition-transform"
        x-show="mobileMenuOpen"
        x-transition:enter="transition-transform duration-300"
        x-transition:enter-start="translate-x-full"
        x-transition:enter-end="translate-x-0"
        x-transition:leave="transition-transform duration-300"
        x-transition:leave-start="translate-x-0"
        x-transition:leave-end="translate-x-full"
        x-cloak
      >
        <!-- Mobile menu header -->
        <div class="flex items-center justify-between p-4 border-b border-gray-600">
          <span class="font-mono text-lg text-white">Menu</span>
          <button @click="mobileMenuOpen = false" class="text-gray-400 hover:text-white">
            <span class="sr-only">Close menu</span>
            ✕
          </button>
        </div>

        <!-- Mobile navigation -->
        <nav class="p-4 space-y-4">
          {% main_menu max_levels=1 template="wagtailmenus/main_menu_mobile_tailwind.html" %}
        </nav>

        <!-- Mobile search -->
        <div class="p-4 border-t border-gray-600">
          <form method="get" action="/search/" role="search">
            <input
              type="text"
              name="q"
              placeholder="Search..."
              class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-400"
              aria-label="Search our website"
            />
          </form>
        </div>

        <!-- Mobile login links -->
        <div class="p-4 border-t border-gray-600 space-y-3">
          <a href="/garden/" class="flex items-center space-x-3 p-3 rounded-lg bg-gray-700 hover:bg-gray-600">
            <span class="text-xl">🌱</span>
            <div>
              <div class="font-mono text-sm text-purple-400">Garden Login</div>
              <div class="text-xs text-gray-400">Research platform</div>
            </div>
          </a>
          <a
            href="https://app.altruist.com/login"
            class="flex items-center space-x-3 p-3 rounded-lg bg-gray-700 hover:bg-gray-600"
            target="_blank"
          >
            <span class="text-xl">👤</span>
            <div>
              <div class="font-mono text-sm text-purple-400">Client Login</div>
              <div class="text-xs text-gray-400">Portfolio access</div>
            </div>
          </a>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-1" role="main">{% block content %}{% endblock %}</main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-600 mt-16">
      <div class="container-ec py-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Company Info -->
          <div>
            <h3 class="font-mono text-sm uppercase text-purple-400 mb-4">Ethical Capital</h3>
            <p class="text-sm text-gray-400 mb-4">
              Socially responsible investment advisory services with a focus on sustainable and ethical investing.
            </p>
            <div class="text-xs text-gray-500">
              <p>Investment Adviser Representative</p>
              <p>CRD #316032</p>
            </div>
          </div>

          <!-- Quick Links -->
          <div>
            <h3 class="font-mono text-sm uppercase text-purple-400 mb-4">Quick Links</h3>
            <ul class="space-y-2 text-sm">
              <li><a href="/about/" class="text-gray-400 hover:text-purple-400 transition-colors">About</a></li>
              <li><a href="/process/" class="text-gray-400 hover:text-purple-400 transition-colors">Process</a></li>
              <li><a href="/blog/" class="text-gray-400 hover:text-purple-400 transition-colors">Blog</a></li>
              <li><a href="/contact/" class="text-gray-400 hover:text-purple-400 transition-colors">Contact</a></li>
            </ul>
          </div>

          <!-- Legal -->
          <div>
            <h3 class="font-mono text-sm uppercase text-purple-400 mb-4">Legal</h3>
            <ul class="space-y-2 text-sm">
              <li>
                <a href="/privacy/" class="text-gray-400 hover:text-purple-400 transition-colors">Privacy Policy</a>
              </li>
              <li>
                <a href="/terms/" class="text-gray-400 hover:text-purple-400 transition-colors">Terms of Service</a>
              </li>
              <li>
                <a href="/disclosures/" class="text-gray-400 hover:text-purple-400 transition-colors">Disclosures</a>
              </li>
            </ul>
          </div>
        </div>

        <div class="border-t border-gray-600 mt-8 pt-8 text-center">
          <p class="text-xs text-gray-500">© {{ "now"|date:"Y" }} Ethical Capital. All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
