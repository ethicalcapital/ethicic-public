{% extends "public_site/base_tailwind.html" %}
{% load wagtailcore_tags static %}

{% block title %}{{ page.title }} - Ethical Capital{% endblock %}

{% block meta_description %}Frequently asked questions about ethical investing, ESG strategies, and Ethical Capital's investment process. Get answers to common questions about sustainable finance.{% endblock %}

{% block content %}
<div class="container-ec py-8">
    <!-- FAQ Hero Section -->
    <section class="card-ec mb-8" role="banner" aria-labelledby="faq-heading">
        <div class="card-header-ec">
            <h1 id="faq-heading" class="card-title-ec">{{ page.title }}</h1>
        </div>
        {% if page.intro_text %}
        <div class="card-content-ec">
            <div class="text-gray-200">
                {{ page.intro_text|richtext }}
            </div>
        </div>
        {% endif %}
    </section>

    <!-- Featured FAQ Section -->
    {% if page.faq_items.all|length > 0 %}
        {% with featured_faq=page.faq_items.all.0 %}
        <section class="bg-purple-900 bg-opacity-30 border border-purple-800 rounded-lg p-6 mb-8">
            <div class="badge-ec-primary mb-4">Featured</div>
            <h3 class="font-mono text-xl text-purple-400 font-semibold mb-3">{{ featured_faq.question }}</h3>
            <p class="text-gray-200 mb-4">{{ featured_faq.answer|richtext|truncatewords:30|striptags }}</p>
            <a href="#faq-1" class="btn-ec-primary">Read Full Answer</a>
        </section>
        {% endwith %}
    {% endif %}

    <!-- FAQ Content Section -->
    <div class="grid-2col">
        <!-- Main FAQ Content -->
        <div class="space-y-4">
            {% for faq in page.faq_items.all %}
                <details class="card-ec" id="faq-{{ forloop.counter }}" data-faq-id="{{ forloop.counter }}">
                    <summary class="cursor-pointer hover:bg-gray-700 transition-colors p-2 -m-2 rounded">
                        <div class="flex items-center justify-between">
                            <h3 class="font-mono text-purple-400 font-semibold pr-4">{{ faq.question }}</h3>
                            <span class="flex-shrink-0 w-6 h-6 bg-purple-900 text-white rounded-full flex items-center justify-center text-sm font-mono font-bold">
                                +
                            </span>
                        </div>
                    </summary>
                    <div class="mt-4 pt-4 border-t border-gray-600 text-gray-200">
                        {{ faq.answer|richtext }}
                    </div>
                </details>
            {% empty %}
                <div class="card-ec text-center">
                    <div class="card-content-ec">
                        <p class="text-gray-400">No FAQ items have been added yet.</p>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- FAQ Sidebar -->
        <div class="space-y-6">
            <!-- Quick Navigation -->
            <div class="card-ec">
                <div class="card-header-ec">
                    <h3 class="card-title-ec">Quick Navigation</h3>
                </div>
                <div class="card-content-ec">
                    <nav aria-label="FAQ Navigation">
                        <ul class="space-y-2">
                            {% for faq in page.faq_items.all %}
                            <li>
                                <a href="#faq-{{ forloop.counter }}" 
                                   class="text-purple-400 hover:text-purple-300 transition-colors text-sm block py-1">
                                    {{ forloop.counter }}. {{ faq.question|truncatewords:8 }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Contact CTA -->
            <div class="card-ec">
                <div class="card-content-ec text-center space-y-4">
                    <h4 class="font-mono text-purple-400 font-semibold">Still Have Questions?</h4>
                    <p class="text-gray-200 text-sm">
                        Can't find what you're looking for? Our team is here to help.
                    </p>
                    <div class="space-y-3">
                        <a href="/contact/" class="btn-ec-primary block">Contact Us</a>
                        <a href="mailto:sloane@ethicalcapital.com" 
                           class="text-purple-400 hover:text-purple-300 transition-colors text-sm">
                            sloane@ethicalcapital.com
                        </a>
                    </div>
                </div>
            </div>

            <!-- Related Resources -->
            <div class="card-ec">
                <div class="card-header-ec">
                    <h4 class="card-title-ec">Related Resources</h4>
                </div>
                <div class="card-content-ec space-y-3">
                    <a href="/process/" 
                       class="block text-purple-400 hover:text-purple-300 transition-colors text-sm py-1">
                        Our Investment Process
                    </a>
                    <a href="/strategies/" 
                       class="block text-purple-400 hover:text-purple-300 transition-colors text-sm py-1">
                        Investment Strategies
                    </a>
                    <a href="/about/" 
                       class="block text-purple-400 hover:text-purple-300 transition-colors text-sm py-1">
                        About Ethical Capital
                    </a>
                    <a href="/blog/" 
                       class="block text-purple-400 hover:text-purple-300 transition-colors text-sm py-1">
                        Investment Blog
                    </a>
                </div>
            </div>

            <!-- Regulatory Info -->
            <div class="card-ec">
                <div class="card-content-ec">
                    <div class="text-center space-y-2">
                        <div class="badge-ec-primary">SEC Registered</div>
                        <p class="text-xs text-gray-400">
                            Investment Adviser Representative<br>
                            CRD: 7114756 | SEC: 801-120708
                        </p>
                        <a href="https://brokercheck.finra.org/individual/summary/7114756" 
                           target="_blank" 
                           rel="noopener noreferrer"
                           class="text-purple-400 hover:text-purple-300 text-xs">
                            View BrokerCheck Profile
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Enhanced details styling for better UX */
details[open] summary span {
    transform: rotate(45deg);
}

details summary span {
    transition: transform 0.2s ease;
}

/* Smooth animation for opening/closing */
details[open] > div {
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Remove default summary marker */
details summary {
    list-style: none;
}

details summary::-webkit-details-marker {
    display: none;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Enhanced FAQ functionality
document.addEventListener('DOMContentLoaded', function() {
    // Handle FAQ deep linking
    if (window.location.hash) {
        const target = document.querySelector(window.location.hash);
        if (target && target.tagName === 'DETAILS') {
            target.open = true;
            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    // Update URL hash when FAQ items are opened
    document.querySelectorAll('details').forEach(detail => {
        detail.addEventListener('toggle', function() {
            if (this.open) {
                history.replaceState(null, null, '#' + this.id);
                
                // Close other FAQ items for better UX
                document.querySelectorAll('details').forEach(other => {
                    if (other !== this && other.open) {
                        other.open = false;
                    }
                });
            }
        });
    });

    // Smooth scroll for navigation links
    document.querySelectorAll('a[href^="#faq-"]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.open = true;
                target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                history.pushState(null, null, this.getAttribute('href'));
            }
        });
    });
});
</script>
{% endblock %}