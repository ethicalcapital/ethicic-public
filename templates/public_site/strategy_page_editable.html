{% extends "public_site/base_tailwind.html" %}
{% load static wagtailcore_tags %}
{% block title %}{{ page.title }} | Ethical Capital{% endblock %}
{% block body_class %}strategy-page{% endblock %}
{% block content %}
    <div class="container-ec">
        <!-- Strategy Header -->
        <section class="mb-8 rounded-lg border border-gray-600 bg-gray-800"
                 role="banner"
                 aria-labelledby="strategy-heading">
            <div class="relative border-b border-gray-600 bg-gray-700 p-6">
                <h2 class="heading-h2 text-lg font-semibold text-blue-300 uppercase">{{ page.title|upper }}</h2>
                {% if page.strategy_label %}
                    <div class="absolute top-3 right-4 rounded bg-purple-900 px-4 py-2 text-sm font-semibold text-white border-2 border-white">
                        {{ page.strategy_label }}
                    </div>
                {% endif %}
            </div>
            <div class="p-6">
                <h1 id="strategy-heading"
                    class="mb-4 heading-h1 text-3xl font-bold text-white">{{ page.title }}</h1>
                {% if page.strategy_subtitle %}<div class="mb-4 text-xl text-purple-300">{{ page.strategy_subtitle }}</div>{% endif %}
                {% if page.strategy_description %}
                    <div class="mb-6 prose text-gray-300">{{ page.strategy_description|richtext }}</div>
                {% endif %}
                <!-- Quick Access Actions -->
                <div class="flex flex-wrap gap-4">
                    <a href="#performance" class="btn-ec-secondary">View Performance</a>
                    <a href="#portfolio" class="btn-ec-secondary">Portfolio Details</a>
                    <a href="#documents" class="btn-ec-primary">Documents & Reports</a>
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLSdx1ex4pj5iYaj1v1Yxjt7iFbicqZbKWNuOZVyMlG8sKswbgQ/viewform?usp=header"
                       class="btn-ec-secondary"
                       target="_blank"
                       rel="noopener">Get Started</a>
                </div>
            </div>
        </section>
        <!-- Two Column Layout -->
        <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
            <!-- Main Content Column -->
            <div class="lg:col-span-2">
                <!-- Performance Summary -->
                <section class="mb-8 rounded-lg border border-gray-600 bg-gray-800"
                         role="complementary"
                         aria-labelledby="performance-heading">
                    <div class="border-b border-gray-600 bg-gray-700 p-4">
                        <h2 class="heading-h2 text-lg font-semibold text-blue-300 uppercase">PERFORMANCE SUMMARY</h2>
                        {% if page.get_performance_as_of_text %}
                            <div class="text-sm text-gray-400 mt-1">{{ page.get_performance_as_of_text }}</div>
                        {% endif %}
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-2 gap-4 md:grid-cols-4">
                            <div class="rounded-lg border border-gray-600 bg-gray-700 p-4 text-center">
                                <div class="mb-2 font-mono text-2xl font-bold text-white">{{ page.ytd_return }}</div>
                                <div class="text-sm text-gray-400 uppercase">YTD Return</div>
                            </div>
                            <div class="rounded-lg border border-gray-600 bg-gray-700 p-4 text-center">
                                <div class="mb-2 font-mono text-2xl font-bold text-white">{{ page.one_year_return }}</div>
                                <div class="text-sm text-gray-400 uppercase">1 Year</div>
                            </div>
                            <div class="rounded-lg border border-gray-600 bg-gray-700 p-4 text-center">
                                <div class="mb-2 font-mono text-2xl font-bold text-white">{{ page.three_year_return }}</div>
                                <div class="text-sm text-gray-400 uppercase">3 Year</div>
                            </div>
                            <div class="rounded-lg border border-gray-600 bg-gray-700 p-4 text-center">
                                <div class="mb-2 font-mono text-2xl font-bold text-white">{{ page.since_inception_return }}</div>
                                <div class="text-sm text-gray-400 uppercase">Since Inception</div>
                            </div>
                        </div>
                        <!-- Performance Table with Benchmark -->
                        <div id="performance" class="mt-8">
                            <h3 class="mb-4 heading-h3 text-lg font-semibold text-blue-300 uppercase">
                                PERFORMANCE VS {{ page.benchmark_name|default:"BENCHMARK" }}
                            </h3>
                            {% if page.get_performance_as_of_text %}
                                <p class="text-sm text-gray-400 mb-2">{{ page.get_performance_as_of_text }}</p>
                            {% endif %}
                            <div class="overflow-x-auto">
                                <table class="w-full rounded-lg border border-gray-600 bg-gray-700">
                                    <thead>
                                        <tr class="bg-gray-600">
                                            <th class="p-3 text-left font-mono text-sm font-semibold text-blue-300 uppercase">PERIOD</th>
                                            <th class="p-3 text-left font-mono text-sm font-semibold text-blue-300 uppercase">{{ page.title|upper }}</th>
                                            <th class="p-3 text-left font-mono text-sm font-semibold text-blue-300 uppercase">{{ page.benchmark_name }}</th>
                                            <th class="p-3 text-left font-mono text-sm font-semibold text-blue-300 uppercase">DIFFERENCE</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-t border-gray-600">
                                            <td class="p-3 text-sm text-gray-300">YTD</td>
                                            <td class="p-3 text-sm font-semibold text-green-400">{{ page.ytd_return }}</td>
                                            <td class="p-3 text-sm text-gray-300">{{ page.ytd_benchmark }}</td>
                                            <td class="p-3 text-sm font-semibold text-green-400">{{ page.ytd_difference }}</td>
                                        </tr>
                                        <tr class="border-t border-gray-600">
                                            <td class="p-3 text-sm text-gray-300">1 Year</td>
                                            <td class="p-3 text-sm font-semibold text-green-400">{{ page.one_year_return }}</td>
                                            <td class="p-3 text-sm text-gray-300">{{ page.one_year_benchmark }}</td>
                                            <td class="p-3 text-sm font-semibold text-green-400">{{ page.one_year_difference }}</td>
                                        </tr>
                                        <tr class="border-t border-gray-600">
                                            <td class="p-3 text-sm text-gray-300">3 Year</td>
                                            <td class="p-3 text-sm font-semibold text-green-400">{{ page.three_year_return }}</td>
                                            <td class="p-3 text-sm text-gray-300">{{ page.three_year_benchmark }}</td>
                                            <td class="p-3 text-sm font-semibold text-green-400">{{ page.three_year_difference }}</td>
                                        </tr>
                                        <tr class="border-t border-gray-600">
                                            <td class="p-3 text-sm text-gray-300">Since Inception</td>
                                            <td class="p-3 text-sm font-semibold text-green-400">{{ page.since_inception_return }}</td>
                                            <td class="p-3 text-sm text-gray-300">{{ page.since_inception_benchmark }}</td>
                                            <td class="p-3 text-sm font-semibold text-green-400">{{ page.since_inception_difference }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            {% if page.performance_disclaimer %}
                                <div class="mt-4 prose text-sm text-gray-400">{{ page.performance_disclaimer|richtext }}</div>
                            {% endif %}
                        </div>
                        <!-- Risk Metrics -->
                        {% if page.risk_metrics.exists %}
                            {% with risk_metric=page.risk_metrics.first %}
                                <div class="mt-8">
                                    <h3 class="mb-4 heading-h3 text-lg font-semibold text-blue-300 uppercase">RISK & QUALITY METRICS</h3>
                                    <div class="grid grid-cols-2 gap-4 md:grid-cols-4">
                                        {% if risk_metric.standard_deviation %}
                                            <div class="rounded-lg border border-gray-600 bg-gray-700 p-4 text-center">
                                                <div class="mb-2 font-mono text-xl font-bold text-white">{{ risk_metric.standard_deviation }}</div>
                                                <div class="text-sm text-gray-400 uppercase">Standard Deviation</div>
                                            </div>
                                        {% endif %}
                                        {% if risk_metric.sharpe_ratio %}
                                            <div class="rounded-lg border border-gray-600 bg-gray-700 p-4 text-center">
                                                <div class="mb-2 font-mono text-xl font-bold text-white">{{ risk_metric.sharpe_ratio }}</div>
                                                <div class="text-sm text-gray-400 uppercase">Sharpe Ratio</div>
                                            </div>
                                        {% endif %}
                                        {% if risk_metric.max_drawdown %}
                                            <div class="rounded-lg border border-gray-600 bg-gray-700 p-4 text-center">
                                                <div class="mb-2 font-mono text-xl font-bold text-white">{{ risk_metric.max_drawdown }}</div>
                                                <div class="text-sm text-gray-400 uppercase">Max Drawdown</div>
                                            </div>
                                        {% endif %}
                                        {% if risk_metric.beta %}
                                            <div class="rounded-lg border border-gray-600 bg-gray-700 p-4 text-center">
                                                <div class="mb-2 font-mono text-xl font-bold text-white">{{ risk_metric.beta }}</div>
                                                <div class="text-sm text-gray-400 uppercase">Beta vs {{ page.benchmark_name }}</div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endwith %}
                        {% endif %}
                    </div>
                </section>
                <!-- Portfolio Details -->
                <section id="portfolio"
                         class="mb-8 rounded-lg border border-gray-600 bg-gray-800">
                    <div class="border-b border-gray-600 bg-gray-700 p-4">
                        <h2 class="heading-h2 text-lg font-semibold text-blue-300 uppercase">PORTFOLIO DETAILS</h2>
                    </div>
                    <div class="p-6 space-y-8">
                        <!-- Geographic Allocation -->
                        {% if page.geographic_allocations.exists %}
                            <div>
                                <h3 class="mb-4 heading-h3 text-lg font-semibold text-blue-300 uppercase">GEOGRAPHIC COMPOSITION</h3>
                                <div class="overflow-x-auto">
                                    <table class="w-full rounded-lg border border-gray-600 bg-gray-700">
                                        <thead>
                                            <tr class="bg-gray-600">
                                                <th class="p-3 text-left font-mono text-sm font-semibold text-blue-300 uppercase">REGION</th>
                                                <th class="p-3 text-left font-mono text-sm font-semibold text-blue-300 uppercase">ALLOCATION</th>
                                                <th class="p-3 text-left font-mono text-sm font-semibold text-blue-300 uppercase">{{ page.benchmark_name }}</th>
                                                <th class="p-3 text-left font-mono text-sm font-semibold text-blue-300 uppercase">DIFFERENCE</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for geo in page.geographic_allocations.all %}
                                                <tr class="border-t border-gray-600">
                                                    <td class="p-3 text-sm text-gray-300">{{ geo.region }}</td>
                                                    <td class="p-3 text-sm text-gray-300">{{ geo.allocation_percent }}</td>
                                                    <td class="p-3 text-sm text-gray-300">{{ geo.benchmark_percent }}</td>
                                                    <td class="p-3 text-sm font-semibold {% if geo.difference_percent and geo.difference_percent.0 == '+' %}text-green-400{% else %}text-red-400{% endif %}">
                                                        {{ geo.difference_percent }}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        {% endif %}
                        <!-- Sector Positioning -->
                        {% if page.sector_positions.exists %}
                            <div>
                                <h3 class="mb-4 heading-h3 text-lg font-semibold text-blue-300 uppercase">SECTOR POSITIONING</h3>
                                <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                                    {% regroup page.sector_positions.all by position_type as position_groups %}
                                    {% for group in position_groups %}
                                        {% if group.grouper == 'overweight' %}
                                            <div class="rounded-lg border border-green-600 bg-green-900/20 p-4">
                                                <h4 class="mb-3 heading-h4 text-sm font-semibold text-green-400 uppercase">OVERWEIGHTS</h4>
                                                <ul class="space-y-1">
                                                    {% for sector in group.list %}<li class="text-sm text-gray-300">{{ sector.sector_name }}</li>{% endfor %}
                                                </ul>
                                                {% if page.overweights_note %}<p class="mt-3 text-xs text-gray-400">{{ page.overweights_note }}</p>{% endif %}
                                            </div>
                                        {% elif group.grouper == 'exclusion' %}
                                            <div class="rounded-lg border border-red-600 bg-red-900/20 p-4">
                                                <h4 class="mb-3 heading-h4 text-sm font-semibold text-red-400 uppercase">EXCLUSIONS</h4>
                                                <ul class="space-y-1">
                                                    {% for sector in group.list %}
                                                        <li class="text-sm text-gray-300">
                                                            {{ sector.sector_name }}
                                                            {% if sector.note %}*{% endif %}
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                                {% if page.exclusions_note %}<p class="mt-3 text-xs text-gray-400">{{ page.exclusions_note }}</p>{% endif %}
                                                {% if page.healthcare_exclusion_note %}
                                                    <div class="mt-3 rounded bg-red-800/30 p-2">
                                                        <p class="text-xs text-gray-300">{{ page.healthcare_exclusion_note }}</p>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </section>
                <!-- Commentary -->
                {% if page.commentary_content %}
                    <section class="mb-8 rounded-lg border border-gray-600 bg-gray-800">
                        <div class="border-b border-gray-600 bg-gray-700 p-4">
                            <h2 class="heading-h2 text-lg font-semibold text-blue-300 uppercase">{{ page.commentary_title|upper }}</h2>
                        </div>
                        <div class="p-6">
                            <div class="prose text-gray-300">{{ page.commentary_content|richtext }}</div>
                        </div>
                    </section>
                {% endif %}
                <!-- Process -->
                {% if page.process_content %}
                    <section class="mb-8 rounded-lg border border-gray-600 bg-gray-800">
                        <div class="border-b border-gray-600 bg-gray-700 p-4">
                            <h2 class="heading-h2 text-lg font-semibold text-blue-300 uppercase">{{ page.process_title|upper }}</h2>
                        </div>
                        <div class="p-6">
                            <div class="prose text-gray-300">{{ page.process_content|richtext }}</div>
                        </div>
                    </section>
                {% endif %}
                <!-- Documents -->
                <section id="documents"
                         class="mb-8 rounded-lg border border-gray-600 bg-gray-800">
                    <div class="border-b border-gray-600 bg-gray-700 p-4">
                        <h2 class="heading-h2 text-lg font-semibold text-blue-300 uppercase">{{ page.documents_title|upper }}</h2>
                    </div>
                    <div class="p-6">
                        {% if page.documents_content %}
                            <div class="mb-6 prose text-gray-300">{{ page.documents_content|richtext }}</div>
                        {% endif %}
                        {% if page.documents.exists %}
                            <div class="space-y-6">
                                {% regroup page.documents.all by get_category_display as document_categories %}
                                {% for category in document_categories %}
                                    <div>
                                        <h3 class="mb-3 heading-h3 text-lg font-semibold text-blue-300">{{ category.grouper }}</h3>
                                        <div class="grid grid-cols-1 gap-3 md:grid-cols-2">
                                            {% for doc in category.list %}
                                                <a href="{% if doc.document_url %}{{ doc.document_url }}{% else %}javascript:requestDocument('{{ doc.title|slugify }}'){% endif %}"
                                                   class="flex items-center space-x-3 rounded-lg border border-gray-600 bg-gray-700 p-4 transition-colors hover:bg-gray-600"
                                                   {% if doc.document_url %}target="_blank" rel="noopener"{% endif %}>
                                                    <div class="text-2xl">{{ doc.icon }}</div>
                                                    <div>
                                                        <div class="font-semibold text-white">{{ doc.title }}</div>
                                                        <div class="text-sm text-gray-400">{{ doc.description }}</div>
                                                    </div>
                                                </a>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </section>
            </div>
            <!-- Right Sidebar Column -->
            <aside class="lg:col-span-1">
                <!-- Quick Access Actions in Right Rail -->
                <section class="mb-8 rounded-lg border border-gray-600 bg-gray-800 lg:sticky lg:top-8">
                    <div class="border-b border-gray-600 bg-gray-700 p-4">
                        <h2 class="heading-h2 text-lg font-semibold text-blue-300 uppercase">QUICK ACCESS</h2>
                    </div>
                    <div class="p-4 space-y-3">
                        <a href="#performance"
                           class="block w-full rounded bg-gray-600 px-4 py-2 text-center text-white transition-colors hover:bg-gray-500">View Performance</a>
                        <a href="#portfolio"
                           class="block w-full rounded bg-gray-600 px-4 py-2 text-center text-white transition-colors hover:bg-gray-500">Portfolio Details</a>
                        <a href="#documents"
                           class="block w-full rounded bg-purple-900 px-4 py-2 text-center text-white transition-colors hover:bg-purple-800">Documents & Reports</a>
                        <a href="https://docs.google.com/forms/d/e/1FAIpQLSdx1ex4pj5iYaj1v1Yxjt7iFbicqZbKWNuOZVyMlG8sKswbgQ/viewform?usp=header"
                           class="block w-full rounded bg-gray-600 px-4 py-2 text-center text-white transition-colors hover:bg-gray-500"
                           target="_blank"
                           rel="noopener">Get Started</a>
                    </div>
                </section>
                <!-- Portfolio Characteristics -->
                <section class="rounded-lg border border-gray-600 bg-gray-800">
                    <div class="border-b border-gray-600 bg-gray-700 p-4">
                        <h2 class="heading-h2 text-lg font-semibold text-blue-300 uppercase">PORTFOLIO CHARACTERISTICS</h2>
                    </div>
                    <div class="p-4">
                        <div class="space-y-4">
                            <div class="flex justify-between border-b border-gray-600 pb-2">
                                <div class="text-sm text-gray-400 uppercase">Holdings</div>
                                <div class="font-semibold text-purple-400">{{ page.holdings_count }}</div>
                            </div>
                            {% if page.inception_date %}
                                <div class="flex justify-between border-b border-gray-600 pb-2">
                                    <div class="text-sm text-gray-400 uppercase">Inception Date</div>
                                    <div class="font-semibold text-purple-400">{{ page.inception_date|date:"M Y" }}</div>
                                </div>
                            {% endif %}
                            <div class="flex justify-between border-b border-gray-600 pb-2">
                                <div class="text-sm text-gray-400 uppercase">Benchmark</div>
                                <div class="font-semibold text-purple-400">{{ page.benchmark_name }}</div>
                            </div>
                            <div class="flex justify-between border-b border-gray-600 pb-2">
                                <div class="text-sm text-gray-400 uppercase">Cash Allocation</div>
                                <div class="font-semibold text-purple-400">{{ page.cash_allocation }}</div>
                            </div>
                            <div class="flex justify-between border-b border-gray-600 pb-2">
                                <div class="text-sm text-gray-400 uppercase">Risk Level</div>
                                <div class="font-semibold text-purple-400">{{ page.risk_level }}</div>
                            </div>
                            <div class="flex justify-between border-b border-gray-600 pb-2">
                                <div class="text-sm text-gray-400 uppercase">Ethical Implementation</div>
                                <div class="font-semibold text-purple-400">{{ page.ethical_implementation }}</div>
                            </div>
                            <div class="flex justify-between">
                                <div class="text-sm text-gray-400 uppercase">Best For</div>
                                <div class="font-semibold text-purple-400">{{ page.best_for }}</div>
                            </div>
                        </div>
                    </div>
                </section>
            </aside>
        </div>
    </div>
{% endblock %}
{% block extra_js %}
    <script>
  function requestDocument(documentType) {
    // Show document request modal
    const modal = document.createElement("div");
    modal.innerHTML = `
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
            <div class="mx-4 max-w-md rounded-lg bg-gray-800 p-6 shadow-xl">
                <div class="mb-4 text-xl font-semibold text-white">Document Request</div>
                <div class="mb-6 text-gray-300">
                    To access this document, please contact our investor relations team:
                    <br><br>
                    📧 Email: <a href="mailto:ir@ethicalcapital.com" class="text-purple-400 hover:text-purple-300">ir@ethicalcapital.com</a><br>
                    📞 Phone: (555) 123-4567<br><br>
                </div>
                <div class="flex space-x-3">
                    <button onclick="window.location.href='mailto:ir@ethicalcapital.com?subject=Document Request: ${documentType}'" class="btn-ec-primary flex-1">SEND EMAIL</button>
                    <button onclick="this.closest('div[class*=\"fixed\"]').remove()" class="btn-ec-secondary flex-1">CLOSE</button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
  }
    </script>
{% endblock %}
