{% extends "public_site/base_tailwind.html" %} {% block title %}Contact Ethical Capital{% endblock %} {% block content
%}
<div class="container-ec py-8">
  <!-- Page Header -->
  <div class="text-center mb-8">
    <h1 class="font-mono text-3xl font-semibold text-white mb-4">Get In Touch</h1>
    <p class="text-gray-400 max-w-2xl mx-auto">
      Ready to explore ethical investing? Reach out to discuss how we can align your investments with your values.
    </p>
  </div>

  <div class="grid-2col">
    <!-- Contact Form -->
    <div class="card-ec">
      <div class="card-header-ec">
        <h2 class="card-title-ec">Send a Message</h2>
      </div>

      <!-- HTMX Contact Form with Alpine.js -->
      <form
        id="contact-form"
        hx-post="/api/contact/"
        hx-target="#form-response"
        hx-indicator="#form-loading"
        hx-swap="innerHTML"
        class="form-ec relative"
        x-data="{
                      submitting: false,
                      submissionId: null,
                      handleSubmit() {
                          this.submitting = true;
                      },
                      handleResponse(event) {
                          this.submitting = false;
                          // Extract submission ID from response if available
                          const response = event.detail.xhr.responseText;
                          try {
                              const data = JSON.parse(response);
                              if (data.submission_id) {
                                  this.submissionId = data.submission_id;
                                  console.log('Form submitted with ID:', this.submissionId);
                                  // Optionally check status after a delay
                                  setTimeout(() => this.checkSubmissionStatus(), 2000);
                              }
                          } catch (e) {
                              // Response might be HTML, not JSON
                          }
                      },
                      async checkSubmissionStatus() {
                          if (!this.submissionId) return;
                          try {
                              const response = await fetch(`/api/submission-status/${this.submissionId}/`);
                              const data = await response.json();
                              console.log('Submission status:', data);
                          } catch (e) {
                              console.log('Could not check submission status:', e);
                          }
                      }
                  }"
        @htmx:before-request="handleSubmit()"
        @htmx:after-request="handleResponse()"
      >
        {% csrf_token %}

        <!-- Name Field (combined name field matching HTMX form) -->
        <div class="form-group-ec">
          <label for="name" class="form-label-ec">Full Name *</label>
          <input
            type="text"
            id="name"
            name="name"
            class="form-input-ec"
            placeholder="Your full name"
            :disabled="submitting"
            required
          />
        </div>

        <!-- Email Field with inline validation -->
        <div class="form-group-ec">
          <label for="email" class="form-label-ec">Email Address *</label>
          <input
            type="email"
            id="email"
            name="email"
            class="form-input-ec"
            placeholder="your@email.com"
            autocomplete="email"
            required
            hx-post="/api/validate-email/"
            hx-trigger="blur changed"
            hx-target="#email-feedback"
            hx-indicator="#email-spinner"
            :disabled="submitting"
            aria-describedby="email-feedback"
            aria-invalid="false"
          />
          <span
            id="email-spinner"
            class="htmx-indicator inline-block ml-2 text-purple-400"
            role="status"
            aria-label="Validating email"
          >
            âŸ³
          </span>
          <div id="email-feedback" class="mt-1 text-sm" role="status" aria-live="polite" aria-atomic="true"></div>
          <p class="form-help-ec">We'll never share your email with anyone else.</p>
        </div>

        <!-- Company Field -->
        <div class="form-group-ec">
          <label for="company" class="form-label-ec">Company</label>
          <input
            type="text"
            id="company"
            name="company"
            class="form-input-ec"
            placeholder="Your company or organization"
            :disabled="submitting"
          />
        </div>

        <!-- Subject -->
        <div class="form-group-ec">
          <label for="subject" class="form-label-ec">Subject *</label>
          <select id="subject" name="subject" class="form-select-ec" :disabled="submitting" required>
            <option value="">Select a topic...</option>
            <option value="investment_inquiry">Investment Inquiry</option>
            <option value="portfolio_review">Portfolio Review</option>
            <option value="esg_consulting">ESG Consulting</option>
            <option value="speaking_request">Speaking Request</option>
            <option value="media_inquiry">Media Inquiry</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Message -->
        <div class="form-group-ec">
          <label for="message" class="form-label-ec">Message *</label>
          <textarea
            id="message"
            name="message"
            class="form-textarea-ec"
            placeholder="Tell us about your investment goals, timeline, or any specific questions you have..."
            :disabled="submitting"
            required
          ></textarea>
        </div>

        <!-- Cloudflare Turnstile -->
        <div class="form-group-ec">
          <div
            class="cf-turnstile"
            data-sitekey="{{ TURNSTILE_SITE_KEY }}"
            data-callback="onTurnstileSuccess"
            data-expired-callback="onTurnstileExpired"
            data-error-callback="onTurnstileError"
          ></div>
          <input type="hidden" name="cf_turnstile_response" value="" />
        </div>

        <!-- Submit Button -->
        <div class="flex gap-4">
          <button type="submit" class="btn-ec-primary" :disabled="submitting" aria-describedby="form-response">
            <span x-show="!submitting">Send Message</span>
            <span x-show="submitting" x-cloak>
              <span class="inline-block animate-spin" role="status" aria-label="Loading">âŸ³</span>
              Sending...
            </span>
          </button>
          <button
            type="reset"
            class="btn-ec-secondary"
            :disabled="submitting"
            @click="$refs.formResponse && ($refs.formResponse.innerHTML = '')"
            aria-label="Clear all form fields"
          >
            Clear Form
          </button>
        </div>

        <!-- Loading indicator -->
        <div
          id="form-loading"
          class="htmx-indicator absolute inset-0 bg-gray-900 bg-opacity-95 flex items-center justify-center rounded-lg"
          role="status"
          aria-label="Form submission in progress"
        >
          <div class="text-center">
            <div class="text-2xl mb-4 animate-spin" aria-hidden="true">âŸ³</div>
            <p class="text-gray-200">Sending your message...</p>
          </div>
        </div>
      </form>

      <!-- Response container -->
      <div
        id="form-response"
        x-ref="formResponse"
        class="mt-4"
        role="status"
        aria-live="polite"
        aria-atomic="true"
      ></div>
    </div>

    <!-- Contact Information -->
    <div class="space-y-6">
      <!-- Direct Contact -->
      <div class="card-ec">
        <div class="card-header-ec">
          <h3 class="card-title-ec">Direct Contact</h3>
        </div>
        <div class="card-content-ec space-y-4">
          <div>
            <h4 class="font-mono text-sm text-purple-400 mb-2">Schedule a Meeting</h4>
            <a
              href="https://calendly.com/sloane-ortel"
              target="_blank"
              rel="noopener noreferrer"
              class="btn-ec-primary inline-block"
            >
              ðŸ“… Book Calendar Slot
            </a>
          </div>

          <div>
            <h4 class="font-mono text-sm text-purple-400 mb-2">Email</h4>
            <a href="mailto:sloane@ethicalcapital.com" class="text-gray-200 hover:text-purple-400 transition-colors">
              sloane@ethicalcapital.com
            </a>
          </div>

          <div>
            <h4 class="font-mono text-sm text-purple-400 mb-2">Professional Networks</h4>
            <div class="flex flex-wrap gap-2">
              <a
                href="https://linkedin.com/in/sloane-ortel"
                target="_blank"
                rel="noopener noreferrer"
                class="social-link-ec"
              >
                <span>ðŸ”—</span>
                <span>LinkedIn</span>
              </a>
              <a
                href="https://brokercheck.finra.org/individual/summary/7114756"
                target="_blank"
                rel="noopener noreferrer"
                class="social-link-ec"
              >
                <span>ðŸ“‹</span>
                <span>BrokerCheck</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Office Info -->
      <div class="card-ec">
        <div class="card-header-ec">
          <h3 class="card-title-ec">Office Information</h3>
        </div>
        <div class="card-content-ec space-y-3">
          <div>
            <span class="badge-ec-primary">Investment Adviser Representative</span>
          </div>
          <div class="text-sm text-gray-400">
            <p>CRD #316032</p>
          </div>
          <div class="text-xs text-gray-500 pt-3 border-t border-gray-600">
            <p>
              Ethical Capital operates as a Registered Investment Adviser. All investment advice is provided in
              accordance with applicable regulations.
            </p>
          </div>
        </div>
      </div>

      <!-- Response Time -->
      <div class="card-ec">
        <div class="card-content-ec">
          <div class="flex items-center space-x-3">
            <span class="text-2xl">âš¡</span>
            <div>
              <h4 class="font-mono text-sm text-purple-400">Quick Response</h4>
              <p class="text-sm text-gray-400">Typically respond within 24 hours during business days</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<!-- Cloudflare Turnstile Script -->
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<script>
  // Turnstile callback functions
  function onTurnstileSuccess(token) {
    // Store the token in the hidden field
    const hiddenField = document.querySelector('input[name="cf_turnstile_response"]');
    if (hiddenField) {
      hiddenField.value = token;
    }
    console.log("Turnstile verification successful");
  }

  function onTurnstileExpired() {
    // Clear the token when expired
    const hiddenField = document.querySelector('input[name="cf_turnstile_response"]');
    if (hiddenField) {
      hiddenField.value = "";
    }
    console.log("Turnstile token expired");
  }

  function onTurnstileError(error) {
    // Clear the token on error
    const hiddenField = document.querySelector('input[name="cf_turnstile_response"]');
    if (hiddenField) {
      hiddenField.value = "";
    }
    console.log("Turnstile error:", error);
  }

  // Custom CSS for form states
  const styleSheet = document.createElement("style");
  styleSheet.textContent = `
    /* HTMX Loading States */
    .htmx-indicator {
        display: none;
    }

    .htmx-request .htmx-indicator {
        display: block;
    }

    .htmx-request #form-loading {
        display: flex !important;
    }

    /* Email validation feedback */
    #email-feedback.valid {
        color: var(--color-success, #10b981);
    }

    #email-feedback.invalid {
        color: var(--color-error, #ef4444);
    }

    /* Spinner animation */
    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .animate-spin {
        animation: spin 1s linear infinite;
    }

    /* Form disabled state */
    .form-input-ec:disabled,
    .form-select-ec:disabled,
    .form-textarea-ec:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* Turnstile styling */
    .cf-turnstile {
        margin: 1rem 0;
    }
`;
  document.head.appendChild(styleSheet);
</script>
{% endblock %}
