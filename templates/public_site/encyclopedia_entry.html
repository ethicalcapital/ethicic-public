{% extends "public_site/base_tailwind.html" %}
{% load blog_filters %}
{% block title %}
    {{ page.title }} | Investment
    Encyclopedia
{% endblock %}
{% block body_class %}encyclopedia-entry{% endblock %}
{% block content %}
    <div class="container-ec">
        <!-- Breadcrumb Navigation -->
        <nav class="mb-6">
            <div class="flex items-center space-x-2 text-sm text-gray-400">
                <a href="/encyclopedia/"
                   class="text-purple-600 hover:underline dark:text-purple-400">Encyclopedia</a>
                <span>›</span>
                {% if page.get_parent.title != "Encyclopedia" %}
                    <a href="{{ page.get_parent.url }}"
                       class="text-purple-600 hover:underline dark:text-purple-400">{{ page.get_parent.title }}</a>
                    <span>›</span>
                {% endif %}
                <span class="text-gray-100">{{ page.title }}</span>
            </div>
        </nav>
        <!-- Entry Header -->
        <section class="mb-8">
            <div>
                <div class="mb-4 flex items-center gap-3">
                    {% if page.category %}
                        <span class="inline-block rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                            {{ page.get_category_display }}
                        </span>
                    {% endif %}
                    {% if page.difficulty_level %}
                        <span class="inline-block rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800 dark:bg-green-900 dark:text-green-200">
                            {{ page.get_difficulty_level_display }}
                        </span>
                    {% endif %}
                </div>
                <h1 class="mb-4 text-4xl font-bold text-gray-100">{{ page.title }}</h1>
                {% if page.summary %}
                    <div class="text-xl leading-relaxed text-gray-400">{{ page.summary }}</div>
                {% endif %}
            </div>
        </section>
        <!-- Main Content -->
        <main>
            <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
                <!-- Main Content -->
                <div class="lg:col-span-2">
                    {% if page.detailed_content %}
                        <div class="mb-8">
                            <h2 class="mb-4 text-2xl font-bold text-gray-100">Detailed Explanation</h2>
                            <div class="prose prose-lg prose-purple dark:prose-invert max-w-none">{{ page.detailed_content|safe }}</div>
                        </div>
                    {% endif %}
                    {% if page.examples %}
                        <div class="mb-8">
                            <h2 class="mb-4 text-2xl font-bold text-gray-100">Examples & Use Cases</h2>
                            <div class="prose prose-lg prose-purple dark:prose-invert max-w-none">{{ page.examples|safe }}</div>
                        </div>
                    {% endif %}
                    {% if page.further_reading %}
                        <div class="mb-8">
                            <h2 class="mb-4 text-2xl font-bold text-gray-100">Further Reading</h2>
                            <div class="prose prose-lg prose-purple dark:prose-invert max-w-none">{{ page.further_reading|safe }}</div>
                        </div>
                    {% endif %}
                </div>
                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Quick Info -->
                    <div class="rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
                        <h3 class="mb-4 text-lg font-semibold text-gray-100">Quick Info</h3>
                        <div class="space-y-3">
                            <div>
                                <span class="font-medium text-gray-300">Category:</span>
                                <span class="ml-2 text-gray-400">
                                    {% if page.category %}
                                        {{ page.get_category_display }}
                                    {% else %}
                                        General
                                    {% endif %}
                                </span>
                            </div>
                            <div>
                                <span class="font-medium text-gray-300">Difficulty:</span>
                                <span class="ml-2 text-gray-400">
                                    {% if page.difficulty_level %}
                                        {{ page.get_difficulty_level_display }}
                                    {% else %}
                                        Beginner
                                    {% endif %}
                                </span>
                            </div>
                            {% if page.related_terms %}
                                <div>
                                    <span class="font-medium text-gray-300">Related Terms:</span>
                                    <div class="mt-2 flex flex-wrap gap-2">
                                        {% for term in page.related_terms|split:"," %}
                                            <span class="inline-block rounded bg-gray-100 px-2 py-1 text-sm text-gray-700 dark:bg-gray-700 dark:text-gray-300">
                                                {{ term|trim }}
                                            </span>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <!-- Related Entries -->
                    {% with related_entries=page.get_related_entries %}
                        {% if related_entries %}
                            <div class="rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
                                <h3 class="mb-4 text-lg font-semibold text-gray-100">Related Entries</h3>
                                <div class="space-y-4">
                                    {% for entry in related_entries %}
                                        <div>
                                            <a href="{{ entry.url }}"
                                               class="font-medium text-purple-600 hover:underline dark:text-purple-400">
                                                {{ entry.title }}
                                            </a>
                                            <div class="mt-1 text-sm text-gray-400">{{ entry.summary|truncatewords:15 }}</div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    {% endwith %}
                    <!-- Navigation -->
                    <div class="rounded-lg border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
                        <h3 class="mb-4 text-lg font-semibold text-gray-100">Browse Encyclopedia</h3>
                        <div class="space-y-2">
                            <a href="/encyclopedia/"
                               class="block text-purple-600 hover:underline dark:text-purple-400">← All Entries</a>
                            {% if page.title.0 %}
                                <a href="/encyclopedia/{{ page.title.0|lower }}/"
                                   class="block text-purple-600 hover:underline dark:text-purple-400">
                                    More "{{ page.title.0|upper }}" Terms
                                </a>
                            {% endif %}
                            {% if page.category %}
                                <a href="/encyclopedia/#category-{{ page.category }}"
                                   class="block text-purple-600 hover:underline dark:text-purple-400">
                                    {{ page.get_category_display }} Category
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!-- Bottom Navigation -->
        <section class="mt-12 border-t border-gray-200 pt-8 dark:border-gray-700">
            <div class="flex flex-col items-center justify-between gap-4 sm:flex-row">
                <a href="/encyclopedia/"
                   class="font-medium text-purple-600 hover:underline dark:text-purple-400">
                    ← Back to Encyclopedia Index
                </a>
                <div class="flex items-center gap-4">
                    <span class="text-gray-400">Share:</span>
                    <button onclick="shareEntry()"
                            class="text-purple-600 hover:underline dark:text-purple-400">Copy Link</button>
                    <a href="mailto:?subject={{ page.title|urlencode }}&body=Check out this investment term: {{ request.build_absolute_uri }}"
                       class="text-purple-600 hover:underline dark:text-purple-400">Email</a>
                </div>
            </div>
        </section>
    </div>
{% endblock %}
{% block extra_css %}{% endblock %}
{% block extra_js %}
    <script>
  function shareEntry() {
    if (navigator.share) {
      navigator.share({
        title: "{{ page.title|escapejs }} | Investment Encyclopedia",
        text: "{{ page.summary|escapejs }}",
        url: window.location.href,
      });
    } else {
      // Fallback: copy to clipboard
      navigator.clipboard.writeText(window.location.href).then(function () {
        alert("Link copied to clipboard!");
      });
    }
  }

  // Smooth scroll for anchor links
  document.addEventListener("DOMContentLoaded", function () {
    const anchorLinks = document.querySelectorAll('a[href^="#"]');

    anchorLinks.forEach((link) => {
      link.addEventListener("click", function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute("href"));
        if (target) {
          target.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      });
    });
  });
    </script>
{% endblock %}
