{% extends "public_site/base_tailwind.html" %}
{% load wagtailcore_tags static %}
{% block title %}
    {{ page.title }} -
    Ethical Capital
{% endblock %}
{% block meta_description %}
    Frequently asked questions about ethical investing, ESG
    strategies, investment process, and Ethical Capital's services. Find answers to common investor questions.
{% endblock %}
{% block content %}
    <div class="container-ec">
        <!-- Hero Section -->
        <section class="mb-8 rounded-xl bg-gradient-to-br from-blue-900 via-gray-900 to-blue-800 p-8 text-center"
                 role="banner"
                 aria-labelledby="faq-heading">
            <h1 id="faq-heading"
                class="mb-4 text-4xl font-bold text-white md:text-5xl">{{ page.title }}</h1>
            {% if page.intro_text %}
                <div class="mx-auto max-w-3xl text-xl text-blue-100">{{ page.intro_text|richtext }}</div>
            {% endif %}
        </section>
        <!-- FAQ Categories Grid -->
        {% if page.get_children.live %}
            <section class="mb-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
                {% for faq_page in page.get_children.live %}
                    <article class="rounded-xl border border-gray-200 bg-white p-6 transition-colors hover:border-purple-400 dark:border-gray-700 dark:bg-gray-800 dark:hover:border-purple-500">
                        <div class="space-y-4">
                            <!-- Category Icon/Badge -->
                            <div class="flex items-center justify-between">
                                <span class="rounded-full bg-purple-600 px-3 py-1 text-sm font-semibold text-white">{{ faq_page.title }}</span>
                                <span class="text-sm text-purple-600 dark:text-purple-400">
                                    {% if faq_page.faq_items.count %}
                                        {{ faq_page.faq_items.count }} Q&A
                                    {% else %}
                                        New
                                    {% endif %}
                                </span>
                            </div>
                            <!-- Description -->
                            {% if faq_page.intro_text %}
                                <p class="text-sm text-gray-600 dark:text-gray-300">{{ faq_page.intro_text|richtext|striptags|truncatewords:25 }}</p>
                            {% endif %}
                            <!-- Preview Questions -->
                            {% if faq_page.faq_items.all %}
                                <div class="space-y-2">
                                    <h4 class="font-mono text-xs font-semibold text-purple-600 uppercase dark:text-purple-400">Sample Questions:</h4>
                                    <ul class="space-y-1">
                                        {% for faq in faq_page.faq_items.all|slice:":3" %}
                                            <li class="text-xs text-gray-500 dark:text-gray-400">â€¢ {{ faq.question|truncatewords:8 }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                            <!-- Action Button -->
                            <a href="{{ faq_page.url }}"
                               class="block w-full rounded-lg border border-gray-300 px-4 py-2 text-center font-semibold text-gray-700 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700">
                                View FAQ Category
                            </a>
                        </div>
                    </article>
                {% endfor %}
            </section>
        {% endif %}
        <!-- Popular Questions Section -->
        {% if popular_questions %}
            <section class="mb-8 rounded-xl border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
                <h2 class="mb-6 text-2xl font-bold text-gray-100">Popular Questions</h2>
                <div class="space-y-4">
                    {% for question in popular_questions %}
                        <details class="rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-600 dark:bg-gray-700">
                            <summary class="-m-2 cursor-pointer rounded p-2 transition-colors hover:bg-gray-100 dark:hover:bg-gray-600">
                                <div class="flex items-center justify-between">
                                    <h3 class="pr-4 font-semibold text-gray-100">{{ question.question }}</h3>
                                    <span class="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-purple-600 text-sm font-bold text-white">
                                        +
                                    </span>
                                </div>
                            </summary>
                            <div class="mt-4 border-t border-gray-200 pt-4 text-gray-700 dark:border-gray-600 dark:text-gray-300">
                                {{ question.answer|richtext }}
                            </div>
                        </details>
                    {% endfor %}
                </div>
            </section>
        {% endif %}
        <!-- Search FAQ Section -->
        <section class="mb-8 rounded-xl border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
            <h3 class="mb-6 text-2xl font-bold text-gray-100">Search FAQ</h3>
            <form class="space-y-4" onsubmit="return searchFAQ(event)">
                <div class="space-y-2">
                    <label for="faq-search"
                           class="block text-sm font-semibold text-gray-100">
                        Search for answers
                    </label>
                    <input type="text"
                           id="faq-search"
                           name="q"
                           class="w-full rounded-lg border border-gray-300 bg-white px-4 py-3 text-gray-900 focus:border-transparent focus:ring-2 focus:ring-purple-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100"
                           placeholder="e.g., minimum investment, ESG screening..."
                           autocomplete="off" />
                    <p class="text-sm text-gray-400">
                        Try searching for terms like "investment minimum", "ESG criteria", or "fees"
                    </p>
                </div>
                <button type="submit"
                        class="rounded-lg bg-purple-600 px-6 py-3 font-semibold text-white transition-colors hover:bg-purple-700">
                    Search FAQ
                </button>
            </form>
            <!-- Search Results -->
            <div id="faq-search-results" class="mt-6 hidden">
                <h4 class="mb-3 text-sm font-semibold text-purple-600 dark:text-purple-400">Search Results:</h4>
                <div id="faq-results-container" class="space-y-3"></div>
            </div>
        </section>
        <!-- Quick Help Section -->
        <section class="mb-8 grid grid-cols-1 gap-6 md:grid-cols-2">
            <!-- Contact Support -->
            <div class="rounded-xl border border-gray-200 bg-white p-6 text-center dark:border-gray-700 dark:bg-gray-800">
                <div class="space-y-4">
                    <div class="text-3xl">ðŸ’¬</div>
                    <h4 class="text-lg font-semibold text-purple-600 dark:text-purple-400">Still Need Help?</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-300">
                        Can't find the answer you're looking for? Our team is here to help with any questions about ethical investing.
                    </p>
                    <div class="space-y-3">
                        <a href="/contact/"
                           class="block rounded-lg bg-purple-600 px-6 py-3 font-semibold text-white transition-colors hover:bg-purple-700">
                            Contact Us
                        </a>
                        <a href="mailto:sloane@ethicalcapital.com"
                           class="text-sm text-purple-600 transition-colors hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300">
                            sloane@ethicalcapital.com
                        </a>
                    </div>
                </div>
            </div>
            <!-- Resources -->
            <div class="rounded-xl border border-gray-200 bg-white p-6 dark:border-gray-700 dark:bg-gray-800">
                <h4 class="mb-4 text-lg font-bold text-gray-100">Helpful Resources</h4>
                <div class="space-y-3">
                    <a href="/process/"
                       class="block border-b border-gray-200 py-2 text-sm text-purple-600 transition-colors hover:text-purple-700 dark:border-gray-600 dark:text-purple-400 dark:hover:text-purple-300">
                        ðŸ“‹ Our Investment Process
                    </a>
                    <a href="/strategies/"
                       class="block border-b border-gray-200 py-2 text-sm text-purple-600 transition-colors hover:text-purple-700 dark:border-gray-600 dark:text-purple-400 dark:hover:text-purple-300">
                        ðŸ“Š Investment Strategies
                    </a>
                    <a href="/about/"
                       class="block border-b border-gray-200 py-2 text-sm text-purple-600 transition-colors hover:text-purple-700 dark:border-gray-600 dark:text-purple-400 dark:hover:text-purple-300">
                        ðŸ‘¤ About Ethical Capital
                    </a>
                    <a href="/blog/"
                       class="block border-b border-gray-200 py-2 text-sm text-purple-600 transition-colors hover:text-purple-700 dark:border-gray-600 dark:text-purple-400 dark:hover:text-purple-300">
                        ðŸ“° Investment Blog
                    </a>
                    <a href="/disclosures/"
                       class="block py-2 text-sm text-purple-600 transition-colors hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300">
                        ðŸ“œ Legal Disclosures
                    </a>
                </div>
            </div>
        </section>
        <!-- Regulatory Information -->
        <section class="rounded-xl border border-gray-200 bg-gray-100 p-6 text-center dark:border-gray-600 dark:bg-gray-800">
            <div class="space-y-3">
                <div class="inline-block rounded-full bg-purple-600 px-4 py-2 text-sm font-semibold text-white">
                    Registered Investment Adviser
                </div>
                <p class="text-sm text-gray-400">Investment Adviser Representative | CRD #316032</p>
                <div class="flex justify-center gap-4 text-xs">
                    <a href="https://brokercheck.finra.org/individual/summary/7114756"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300">
                        BrokerCheck Profile
                    </a>
                    <a href="/disclosures/"
                       class="text-purple-600 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300">
                        Form ADV
                    </a>
                </div>
            </div>
        </section>
    </div>
    <style>
  /* Enhanced details styling */
  details[open] summary span {
    transform: rotate(45deg);
  }

  details summary span {
    transition: transform 0.2s ease;
  }

  details[open] > div {
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  details summary {
    list-style: none;
  }

  details summary::-webkit-details-marker {
    display: none;
  }
    </style>
{% endblock %}
{% block extra_js %}
    <script>
  // FAQ search functionality
  function searchFAQ(event) {
    event.preventDefault();

    const query = document.getElementById("faq-search").value.trim().toLowerCase();
    const resultsContainer = document.getElementById("faq-search-results");
    const resultsContent = document.getElementById("faq-results-container");

    if (!query) {
      resultsContainer.classList.add("hidden");
      return false;
    }

    // Mock search results - in production, this would hit an API endpoint
    const mockResults = [
      {
        question: "What is the minimum investment amount?",
        answer: "Our minimum investment is $100,000 for individual accounts and $500,000 for institutional accounts.",
        page: "Investment Basics",
      },
      {
        question: "How do you screen companies for ESG compliance?",
        answer:
          "We use a comprehensive screening process that evaluates environmental, social, and governance factors...",
        page: "ESG Process",
      },
      {
        question: "What are your management fees?",
        answer:
          "Our management fees are 1% annually for accounts over $100,000, with reduced fees for larger accounts.",
        page: "Fees & Pricing",
      },
    ];

    // Filter results based on query
    const filteredResults = mockResults.filter(
      (result) => result.question.toLowerCase().includes(query) || result.answer.toLowerCase().includes(query)
    );

    // Display results
    resultsContent.innerHTML = "";

    if (filteredResults.length > 0) {
      filteredResults.forEach((result) => {
        const resultDiv = document.createElement("div");
        resultDiv.className = "bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-3";
        resultDiv.innerHTML = `
                <h5 class="text-sm text-purple-600 dark:text-purple-400 font-semibold mb-2">${result.question}</h5>
                <p class="text-xs text-gray-300 mb-2">${result.answer}</p>
                <span class="text-xs text-gray-500 dark:text-gray-400">From: ${result.page}</span>
            `;
        resultsContent.appendChild(resultDiv);
      });
    } else {
      resultsContent.innerHTML =
        '<p class="text-gray-400 text-sm">No results found. Try different keywords or <a href="/contact/" class="text-purple-400 hover:text-purple-300">contact us</a> directly.</p>';
    }

    resultsContainer.classList.remove("hidden");
    return false;
  }

  // Enhanced FAQ functionality
  document.addEventListener("DOMContentLoaded", function () {
    // Auto-focus search on page load
    const searchInput = document.getElementById("faq-search");
    if (searchInput && window.location.hash === "#search") {
      searchInput.focus();
    }

    // Handle FAQ category hover effects
    const faqCards = document.querySelectorAll("article");
    faqCards.forEach((card) => {
      card.addEventListener("mouseenter", function () {
        this.style.transform = "translateY(-2px)";
        this.style.transition = "transform 0.2s ease";
      });

      card.addEventListener("mouseleave", function () {
        this.style.transform = "translateY(0)";
      });
    });

    // Search input enhancements
    if (searchInput) {
      searchInput.addEventListener("input", function () {
        const query = this.value.trim();
        if (query.length > 2) {
          // Auto-search after 500ms delay
          clearTimeout(this.searchTimeout);
          this.searchTimeout = setTimeout(() => {
            searchFAQ({ preventDefault: () => {} });
          }, 500);
        } else if (query.length === 0) {
          document.getElementById("faq-search-results").classList.add("hidden");
        }
      });
    }
  });
    </script>
{% endblock %}
