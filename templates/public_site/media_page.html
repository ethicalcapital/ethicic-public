{% extends "public_site/base_tailwind.html" %}
{% load wagtailcore_tags static %}
<<<<<<< HEAD
{% block title %}
    {{
    page.title|default:"Media & Press" }} | {{ block.super }}
{% endblock %}
{% block meta_description %}
    {{
    page.intro_text|striptags|truncatechars:160 }}
{% endblock %}
{% block body_class %}media-page{% endblock %}
{% block content %}
    <div class="container-ec">
        <!-- Hero Section -->
        <section class="mb-8 bg-gradient-to-br from-purple-900 via-gray-900 to-purple-800 rounded-xl p-8 text-center"
                 role="banner">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">{{ page.title }}</h1>
            {% if page.intro_text %}
                <div class="text-xl text-purple-100 max-w-3xl mx-auto">{{ page.intro_text|richtext }}</div>
            {% endif %}
        </section>
        <!-- Media Coverage -->
        <section class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6 mb-8"
                 role="main">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100">RECENT MEDIA MENTIONS</h2>
                <span class="text-sm text-gray-600 dark:text-gray-400" id="article-count">{{ page.media_items.all.count }} ARTICLES</span>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Media Articles Content -->
                <div class="lg:col-span-2">
                    {% if page.media_items.all %}
                        <div class="space-y-6" id="articles-container">
                            {% for item in page.media_items.all|slice:":6" %}
                                <article class="border-b border-gray-200 dark:border-gray-700 pb-6 last:border-b-0{% if item.featured %} relative{% endif %}"
                                         data-item-id="{{ item.id }}">
                                    {% if item.featured %}
                                        <div class="mb-4">
                                            <span class="inline-block bg-purple-600 text-white px-3 py-1 rounded-full text-sm font-semibold">FEATURED</span>
                                        </div>
                                    {% endif %}
                                    <div class="flex gap-3 mb-3 text-sm">
                                        {% if item.publication %}
                                            <span class="text-purple-600 dark:text-purple-400 font-semibold">{{ item.publication|upper }}</span>
                                        {% endif %}
                                        {% if item.publication_date %}
                                            <span class="text-gray-600 dark:text-gray-400">{{ item.publication_date|date:"M j, Y"|upper }}</span>
                                        {% endif %}
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3 leading-tight">
                                        {% if item.external_url %}
                                            <a href="{{ item.external_url }}"
                                               target="_blank"
                                               rel="noopener noreferrer"
                                               class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors">
                                                {{ item.title }}
                                            </a>
                                        {% else %}
                                            {{ item.title }}
                                        {% endif %}
                                    </h3>
                                    {% if item.description %}
                                        <p class="text-gray-700 dark:text-gray-300 mb-4">{{ item.description|striptags|truncatewords:25 }}</p>
                                    {% endif %}
                                    {% if item.external_url %}
                                        <a href="{{ item.external_url }}"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           class="inline-block px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium">
                                            READ ARTICLE
                                        </a>
                                    {% endif %}
                                </article>
                            {% endfor %}
                        </div>
                        <!-- HTMX Infinite Scroll Trigger -->
                        {% if page.media_items.all.count > 6 %}
                            <div id="load-more-trigger"
                                 hx-get="/api/media-items/?page=2&per_page=6"
                                 hx-trigger="revealed"
                                 hx-target="#articles-container"
                                 hx-swap="beforeend"
                                 hx-indicator="#loading-indicator"
                                 class="h-1 mt-6">
                                <!-- This div triggers loading when it comes into view -->
                            </div>
                        {% endif %}
                        <!-- Loading indicator -->
                        <div id="loading-indicator" class="text-center py-8 hidden htmx-indicator">
                            <div class="inline-block animate-spin text-2xl mb-2">‚ü≥</div>
                            <p class="text-gray-600 dark:text-gray-400">Loading more articles...</p>
                        </div>
                    {% else %}
                        <div class="text-center py-12">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">{{ page.empty_state_title }}</h3>
                            <div class="text-gray-600 dark:text-gray-400">{{ page.empty_state_message|safe }}</div>
                        </div>
                    {% endif %}
                </div>
                <!-- Sidebar -->
                <aside class="space-y-6">
                    {% if page.sidebar_interview_show %}
                        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">{{ page.sidebar_interview_title }}</h3>
                            <div class="text-gray-600 dark:text-gray-400 mb-4 text-sm">{{ page.sidebar_interview_description|safe }}</div>
                            <a href="{{ page.sidebar_interview_button_url }}"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="block w-full text-center px-4 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors">
                                {{ page.sidebar_interview_button_text }}
                            </a>
                        </div>
                    {% endif %}
                    {% if page.sidebar_contact_show %}
                        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">{{ page.sidebar_contact_title }}</h3>
                            <div class="text-gray-600 dark:text-gray-400 mb-4 text-sm">{{ page.sidebar_contact_description|safe }}</div>
                            <a href="{{ page.sidebar_contact_button_url }}"
                               class="block w-full text-center px-4 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-purple-600 transition-colors">
                                {{ page.sidebar_contact_button_text }}
                            </a>
                        </div>
                    {% endif %}
                </aside>
            </div>
=======

{% block title %}{{ page.title|default:"Media & Press" }} | {{ block.super }}{% endblock %}

{% block meta_description %}{{ page.intro_text|striptags|truncatechars:160 }}{% endblock %}

{% block body_class %}media-page{% endblock %}

{% block content %}
<div class="container-ec">
  <!-- Hero Section -->
  <section class="mb-8 bg-gradient-to-br from-purple-900 via-gray-900 to-purple-800 rounded-xl p-8 text-center" role="banner">
    <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">{{ page.title }}</h1>
    {% if page.intro_text %}
    <div class="text-xl text-purple-100 max-w-3xl mx-auto">{{ page.intro_text|richtext }}</div>
    {% endif %}
  </section>

  <!-- Media Coverage -->
  <section class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6 mb-8" role="main">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100">RECENT MEDIA MENTIONS</h2>
      <span class="text-sm text-gray-600 dark:text-gray-400" id="article-count">{{ page.media_items.all.count }} ARTICLES</span>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Media Articles Content -->
      <div class="lg:col-span-2">
          {% if page.media_items.all %}
          <div class="space-y-6" id="articles-container">
            {% for item in page.media_items.all|slice:":6" %}
            <article
              class="border-b border-gray-200 dark:border-gray-700 pb-6 last:border-b-0{% if item.featured %} relative{% endif %}"
              data-item-id="{{ item.id }}"
            >
              {% if item.featured %}
              <div class="mb-4">
                <span class="inline-block bg-purple-600 text-white px-3 py-1 rounded-full text-sm font-semibold">FEATURED</span>
              </div>
              {% endif %}

              <div class="flex gap-3 mb-3 text-sm">
                {% if item.publication %}
                <span class="text-purple-600 dark:text-purple-400 font-semibold">{{ item.publication|upper }}</span>
                {% endif %}
                {% if item.publication_date %}
                <span class="text-gray-600 dark:text-gray-400">{{ item.publication_date|date:"M j, Y"|upper }}</span>
                {% endif %}
              </div>

              <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3 leading-tight">
                {% if item.external_url %}
                <a
                  href="{{ item.external_url }}"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors"
                >
                  {{ item.title }}
                </a>
                {% else %}
                {{ item.title }}
                {% endif %}
              </h3>

              {% if item.description %}
              <p class="text-gray-700 dark:text-gray-300 mb-4">
                {{ item.description|striptags|truncatewords:25 }}
              </p>
              {% endif %}

              {% if item.external_url %}
              <a
                href="{{ item.external_url }}"
                target="_blank"
                rel="noopener noreferrer"
                class="inline-block px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium"
              >
                READ ARTICLE
              </a>
              {% endif %}
            </article>
            {% endfor %}
          </div>

          <!-- HTMX Infinite Scroll Trigger -->
          {% if page.media_items.all.count > 6 %}
          <div
            id="load-more-trigger"
            hx-get="/api/media-items/?page=2&per_page=6"
            hx-trigger="revealed"
            hx-target="#articles-container"
            hx-swap="beforeend"
            hx-indicator="#loading-indicator"
            class="h-1 mt-6"
          >
            <!-- This div triggers loading when it comes into view -->
          </div>
          {% endif %}

          <!-- Loading indicator -->
          <div id="loading-indicator" class="text-center py-8 hidden htmx-indicator">
            <div class="inline-block animate-spin text-2xl mb-2">‚ü≥</div>
            <p class="text-gray-600 dark:text-gray-400">Loading more articles...</p>
          </div>
          {% else %}
          <div class="text-center py-12">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">{{ page.empty_state_title }}</h3>
            <div class="text-gray-600 dark:text-gray-400">{{ page.empty_state_message|safe }}</div>
          </div>
          {% endif %}
>>>>>>> 6ca6df9 (Fix Django template syntax errors and improve site functionality)
        </div>
    </section>
    <!-- Press Kit Section -->
    {% if page.press_kit_title or page.press_kit_description %}
        <section class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-6">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4">
                {{ page.press_kit_title|default:"PRESS KIT & RESOURCES" }}
            </h2>
            {% if page.press_kit_description %}
                <div class="text-gray-700 dark:text-gray-300 mb-6">{{ page.press_kit_description|richtext }}</div>
            {% endif %}
            <div class="flex flex-col sm:flex-row gap-4">
                <a href="/contact/"
                   class="px-6 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-purple-600 transition-colors text-center">
                    Request Press Materials
                </a>
                <a href="https://github.com/ethicalcapital/sage"
                   target="_blank"
                   rel="noopener"
                   class="px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-center">
                    View Open Source Methodology
                </a>
            </div>
        </section>
    {% endif %}
</div>
{% endblock %}
